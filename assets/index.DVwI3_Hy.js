import{u as O,j as e,h as R,i as H,A as $,k,f as l,D as W,T as X,s as G,y as F,F as J,B as c}from"./index.C32mkGiH.js";import{m as K,b as r}from"./vendor.EKSpuOPe.js";import{g as Q}from"./creditCommandeService.Cw882LPK.js";import{P as f}from"./paimentService.BdtATWcV.js";import{f as j}from"./date-format.qL-o8H-f.js";import{W as U}from"./wave-orange-payment-service.5-N65r1_.js";import{T as E}from"./truck.B7ydbKgp.js";function re(){const{id:b}=K(),{user:g}=O(),[s,D]=r.useState(null),[d,M]=r.useState([]),[m,q]=r.useState(!0),[i,v]=r.useState(0),[_,N]=r.useState(""),[A,y]=r.useState(!1),P=t=>{if(!t)return"En cours";switch(String(t).toLowerCase()){case"pending":return"En cours de validation";case"validated":return"Validé";case"rejected":return"Rejeté";default:return"En cours"}},C=t=>{if(!t)return e.jsx(E,{className:"w-5 h-5 text-blue-500"});switch(String(t).toLowerCase()){case"pending":return e.jsx(F,{className:"w-5 h-5 text-yellow-500"});case"validated":return e.jsx(J,{className:"w-5 h-5 text-green-500"});case"rejected":return e.jsx(F,{className:"w-5 h-5 text-red-500"});default:return e.jsx(E,{className:"w-5 h-5 text-blue-500"})}};r.useEffect(()=>{const t=async()=>{try{const a=await Q(g.id,b);D(a);const p=await f.getPaymentDetailsByIdOrder(a.id);M(p||[])}catch(a){console.error("Erreur lors de la récupération de la commande",a),c.error("Impossible de charger les détails de la commande")}finally{q(!1)}};g?.id&&b&&t()},[b,g?.id]);const x=r.useMemo(()=>!s?.payment_lines||!Array.isArray(s.payment_lines)?null:s.payment_lines.find(t=>!t.state)||null,[s]),w=10,n=r.useMemo(()=>{const t=s?.payment_lines||[];if(!t.length)return w;if(!!!t[0]?.state){const h=t.find(z=>!z.state);return Math.max(Number(h?.amount||0),w)}return w},[s]);r.useEffect(()=>{!m&&s&&(v(n),N(""))},[m,s,n]);const S=t=>{t&&window.open(t,"_blank","noopener,noreferrer")},T=async t=>{try{const a=await f.confirmInvoice(t.payment_token);a.response_code==="00"&&a.status==="completed"?(await f.updatePaymentDetails(t.id,a.status,a.receipt_url,a.customer.name,a.customer.email,a.customer.phone,!0),await f.createorderPaimentMontant(t.order_id,t.amount,t.payment_token),c.success("Paiement validé avec succès")):c.error("Vérification du paiement échouée")}catch(a){console.error("Erreur lors de la confirmation de l'invoice :",a),c.error("Erreur lors de la vérification du paiement")}},L=()=>{if(i<n){c.warning("Le montant saisi est insuffisant pour cette étape.",{position:"top-center",autoClose:4e3});return}y(!0)},B=t=>{t.preventDefault(),i<n?c.warning("Le montant saisi est insuffisant pour cette étape.",{position:"top-center",autoClose:4e3}):y(!0)},o=s?.validation_rh_state==="validated"&&s?.validation_admin_state==="validated",u=Number(s?.amount_residual||0)<=0,I=!o||u,V=m||!o||u||i<Math.min(n,Number(s?.amount_residual||0));return e.jsxs(e.Fragment,{children:[e.jsx(R,{title:"CCBM Shop | Détails Commande à Crédit",description:"Découvrez les meilleures offres sur CCBM Shop, votre destination privilégiée pour l'électroménager de qualité. Explorez nos produits allant des réfrigérateurs aux téléviseurs intelligents, et profitez de promotions exclusives !",keywords:"électroménager, boutique en ligne d'électroménager, CCBM Shop, ccbme, appareils électroménagers à prix réduits, smart TV, réfrigérateurs modernes, climatiseurs efficaces, promotions électroménager"}),e.jsx(H,{childrenClasses:"pt-0 pb-0",children:e.jsxs("div",{className:"checkout-page-wrapper w-full bg-white pb-[60px]",children:[e.jsx("div",{className:"w-full mb-5",children:e.jsx($,{title:"Détails Commande à Crédit",breadcrumb:[{name:"Accueil",path:"/"},{name:"Commande à Crédits",path:"/profile#commandes-a-credit"},{name:"Détails Commande à crédit "}]})}),m&&e.jsx(k,{className:"mr-2 h-4 w-4 animate-spin"}),s&&e.jsx("div",{className:"checkout-main-content w-full",children:e.jsxs("div",{className:"container-x mx-auto",children:[e.jsxs("div",{className:"w-full sm:mb-10 mb-5",children:[e.jsxs("div",{className:"sm:flex sm:space-x-[18px]",children:[e.jsx("div",{className:"sm:w-1/3 w-full mb-5 h-[70px]",children:e.jsx("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex justify-center items-center",children:e.jsxs("span",{className:"text-[15px] font-medium",children:["N°Commande à Crédit ",e.jsx("span",{children:s.name})]})})}),e.jsx("div",{className:" sm:w-1/3  flex-1 h-[70px]",children:e.jsx("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex justify-center items-center",children:e.jsxs("span",{className:"text-[15px] font-medium",children:["Paiement :"," ",s.advance_payment_status==="not_paid"&&e.jsx("span",{className:"text-red-500",children:"Non Payé"}),s.advance_payment_status==="paid"&&e.jsx("span",{className:"text-green-500",children:" Payé "}),s.advance_payment_status==="partial"&&e.jsx("span",{className:"text-yellow-500",children:" Partiellement Payé"})]})})}),e.jsx("div",{className:"sm:w-1/3 flex-1 h-[70px]",children:e.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[e.jsx("strong",{children:" Statut : "})," ",e.jsx("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:e.jsxs("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:[s.state==="sale"&&e.jsx("span",{className:"text-green-500",children:"Validé"}),s.state==="draft"&&e.jsx("span",{className:"text-yellow-500",children:"En cours de traitement"}),s.state==="cancel"&&e.jsx("span",{className:"text-yellow-500",children:"Annulée"}),s.state==="delivered"&&e.jsx("span",{className:"text-green-600",children:"Livrée"}),s.state==="to_delivered"&&e.jsx("span",{className:"text-yellow-500",children:"En cours de livraison"}),s.state==="validation"&&e.jsx("span",{className:"text-yellow-500",children:"En cours de validation"})]})})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:space-x-[18px] space-y-5 sm:space-y-0 mb-5",children:[e.jsx("div",{className:"w-full sm:w-1/2 h-auto sm:h-[70px]",children:e.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[e.jsx("strong",{children:"Validation RH"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:[e.jsx("span",{className:"hidden sm:inline-block",children:C(s.validation_rh_state)}),e.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:P(s.validation_rh_state)})]})]})}),e.jsx("div",{className:"w-full sm:w-1/2 h-auto sm:h-[70px]",children:e.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[e.jsx("strong",{children:"Approbation CCBM"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:[e.jsx("span",{className:"hidden sm:inline-block",children:C(s.validation_admin_state)}),e.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:P(s.validation_admin_state)})]})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:space-x-[18px] space-y-5 sm:space-y-0 mb-5",children:[e.jsx("div",{className:"w-full sm:w-1/2 h-auto sm:h-[70px]",children:e.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[e.jsx("strong",{children:" Date commande "}),e.jsx("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:e.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:j(s.date_order)})})]})}),e.jsx("div",{className:"w-full sm:w-1/2 h-auto sm:h-[70px]",children:e.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[e.jsx("strong",{children:"Date de livraison"}),e.jsx("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:e.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:j(s.commitment_date)})})]})})]}),e.jsxs("div",{className:"sm:flex sm:space-x-[18px]",children:[e.jsx("div",{className:"sm:w-1/2 w-full mb-5 h-[70px]",children:e.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[e.jsx("strong",{children:" Total Payé  "}),e.jsx("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:e.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:l(s.amount_total-s.amount_residual)})})]})}),e.jsx("div",{className:"flex-1 h-[70px]",children:e.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[e.jsx("strong",{children:" Total Restant   "}),e.jsx("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:e.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:l(s.amount_residual)})})]})})]}),d&&d.length>0&&e.jsx("div",{className:"w-full lg:flex lg:space-x-[30px]",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"sm:text-2xl text-xl text-qblack font-medium mb-5",children:"Récapitulatif paiement"}),e.jsxs("div",{className:"w-full px-4 sm:px-10 py-[30px] border border-[#EDEDED]",children:[e.jsxs("div",{className:"sub-total mb-6",children:[e.jsx("div",{className:"flex justify-between mb-5",children:e.jsx("p",{className:"text-[13px] font-medium text-qblack uppercase",children:"Détails Payments"})}),e.jsx("div",{className:"w-full h-[1px] bg-[#EDEDED]"})]}),e.jsx("div",{className:"product-list w-full mb-[30px] overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 border-b border-gray-200 bg-gray-50 text-left text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider",children:"Prénom & Nom"}),e.jsx("th",{className:"px-6 py-3 border-b border-gray-200 bg-gray-50 text-left text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider",children:"Téléphone"}),e.jsx("th",{className:"px-6 py-3 border-b border-gray-200 bg-gray-50 text-left text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 border-b border-gray-200 bg-gray-50 text-left text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider",children:"Montant Payé"}),e.jsx("th",{className:"px-6 py-3 border-b border-gray-200 bg-gray-50 text-left text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider",children:"Facture"})]})}),e.jsx("tbody",{children:Array.isArray(d)&&d.map((t,a)=>t.payment_state==="completed"?e.jsxs("tr",{className:"bg-white",children:[e.jsx("td",{className:"px-6 py-4 whitespace-no-wrap border-b border-gray-200",children:e.jsx("div",{className:"text-sm leading-5 text-gray-900",children:t.customer_name})}),e.jsx("td",{className:"px-6 py-4 whitespace-no-wrap border-b border-gray-200",children:e.jsx("div",{className:"text-sm leading-5 text-gray-900",children:t.customer_phone})}),e.jsx("td",{className:"px-6 py-4 whitespace-no-wrap border-b border-gray-200",children:e.jsx("div",{className:"text-sm leading-5 text-gray-900",children:t.customer_email})}),e.jsx("td",{className:"px-6 py-4 whitespace-no-wrap border-b border-gray-200",children:e.jsx("div",{className:"text-sm leading-5 text-gray-900",children:l(t.amount)})}),e.jsx("td",{className:"px-6 py-4 whitespace-no-wrap border-b border-gray-200",children:t.token_status?e.jsx("button",{className:"text-sm leading-5 text-gray-900 underline",onClick:()=>S(t.url_facture),children:"Ouvrir la facture"}):e.jsx("button",{className:"text-sm leading-5 text-gray-900 underline",onClick:()=>T(t),children:"Vérifier le paiement"})})]},a):null)})]})}),e.jsx("div",{className:"w-full h-[1px] bg-[#EDEDED]"})]})]})})]}),e.jsxs("div",{className:"w-full max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl text-qblack font-medium mb-5 text-center",children:"Récapitulatif de la commande"}),e.jsx("div",{className:"w-full p-4 sm:p-6 border border-[#EDEDED] rounded-lg shadow-sm",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center border-b pb-4",children:[e.jsx("p",{className:"text-sm font-medium text-qblack uppercase",children:"Produit"}),e.jsx("p",{className:"text-sm font-medium text-qblack uppercase",children:"Total"})]}),e.jsx("div",{className:"space-y-4",children:Array.isArray(s.order_lines)&&s.order_lines.map((t,a)=>e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"text-sm sm:text-base text-qblack mb-1",children:[t.product_name,e.jsxs("sup",{className:"text-xs text-qgray ml-1",children:["x ",t.product_uom_qty]})]}),!!t.description&&e.jsx("p",{className:"text-xs sm:text-sm text-qgray",children:t.description})]}),e.jsx("span",{className:"text-sm sm:text-base text-qblack font-medium",children:l(t.price_total)})]},a))}),e.jsxs("div",{className:"border-t pt-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("dt",{className:"text-sm text-gray-500",children:["Mode crédit : ",s.creditorder_month_count," paiement(s)"]}),e.jsxs("dd",{className:"text-sm text-gray-900 font-medium",children:["Total: ",l(s.amount_total)]})]}),Array.isArray(s.payment_lines)&&s.payment_lines.map((t,a)=>e.jsxs("dl",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("dt",{className:"text-sm text-gray-500",children:[`Paiement ${a+1}`,t.due_date&&e.jsxs("span",{className:"ml-2 text-xs text-gray-400",children:["(échéance: ",j(t.due_date),")"]})]}),e.jsxs("dd",{className:`text-sm sm:text-base font-medium ${t.state?"text-green-600":"text-gray-900"}`,children:[l(t.amount)," ",t.state?"✓":""]})]},t.sequence??a))]}),e.jsxs("div",{className:"border-t pt-4 space-y-2",children:[e.jsxs("dl",{className:"flex items-center justify-between gap-2",children:[e.jsx("dt",{className:"text-base sm:text-lg font-bold text-gray-900",children:"Total à payer"}),e.jsx("dd",{className:"text-base sm:text-lg font-bold text-gray-900",children:l(s.amount_total)})]}),e.jsxs("dl",{className:"flex items-center justify-between gap-2",children:[e.jsx("dt",{className:"text-base sm:text-lg font-bold text-gray-900",children:"Total Payé"}),e.jsx("dd",{className:"text-base sm:text-lg font-bold text-green-600",children:l(s.amount_total-s.amount_residual)})]}),e.jsxs("dl",{className:"flex items-center justify-between gap-2",children:[e.jsx("dt",{className:"text-base sm:text-lg font-bold text-gray-900",children:"Total Restant"}),e.jsx("dd",{className:"text-base sm:text-lg font-bold text-gray-900",children:l(s.amount_residual)})]})]}),o&&!u?e.jsxs("div",{className:"mt-6",children:[e.jsx(W,{htmlFor:"montant",children:"Montant à payer"}),e.jsx(X,{id:"montant",type:"number",value:i,disabled:I,onChange:t=>{const a=Number(t.target.value||0),p=Number(s.amount_residual||0),h=Math.min(a,p);v(h),h<n?N("Le montant saisi est insuffisant pour cette étape."):N("")},min:n,max:s.amount_residual,className:"mt-1"}),_&&e.jsx("p",{className:"text-red-500 mt-1",children:_}),e.jsxs(G,{onClick:B,className:"mt-4 w-full",disabled:V,children:[m&&e.jsx(k,{className:"mr-2 h-4 w-4 animate-spin"}),"Passer à la caisse (",l(i),")"]}),x&&!s?.payment_lines?.[0]?.state&&e.jsxs("p",{className:"mt-2 text-xs text-gray-500 text-center",children:["Prochain paiement"," ",e.jsxs("strong",{children:[`(Paiement ${Math.max(1,(s.payment_lines||[]).findIndex(t=>t===x)+1)}) : `,l(x.amount)," le"," ",j(x.due_date)]}),"."]})]}):e.jsxs(e.Fragment,{children:[!o&&e.jsx("p",{className:"text-yellow-500 mt-4 text-center text-base sm:text-xl",children:"Merci d'attendre la validation de la commande à crédit par la RH et CCBM"}),u&&e.jsx("p",{className:"text-green-600 mt-4 text-center text-base sm:text-xl",children:"Votre paiement est déjà réglé"})]})]})}),A&&s&&e.jsx(U,{handlePay:L,totalAmount:i,onClose:()=>y(!1),order:s,idOrder:s.id})]})]})}),!s&&e.jsx("div",{className:"flex justify-center items-center ",children:"Commande à Crédit non trouvée"})]})})]})}export{re as default};
