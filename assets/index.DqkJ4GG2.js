import{x as St,u as kt,j as p,M as tt,y as Nt,f as V,s as lt,k as Et,z as At,B as Y,h as Dt,i as Ot,A as Pt,L as ft,D as Lt,T as It}from"./index.C32mkGiH.js";import{f as pt,h as Ut,g as Ct,u as Ft,b as B,m as $t}from"./vendor.EKSpuOPe.js";import{P as K}from"./paimentService.BdtATWcV.js";import{f as ht}from"./date-format.qL-o8H-f.js";import{P as Mt}from"./UserContext.Daa074DN.js";var Q={},et,dt;function Rt(){if(dt)return et;dt=1;function U(O,E){if(!(O&&E&&O.config["PAYDUNYA-MASTER-KEY"]&&O.config["PAYDUNYA-PRIVATE-KEY"]&&O.config["PAYDUNYA-TOKEN"]&&E.name))throw new Error("Invalid parameters;");this.baseURL=O.baseURL,this.config=O.config,E.return_url&&(this.returnURL=E.return_url),E.cancel_url&&(this.cancelURL=E.cancel_url),E.callback_url&&(this.callbackURL=E.callback_url),this.store=E,this.description="",this.items={},this.customData={},this.taxes={},this.channels=[],this.totalAmount=0}return U.prototype.addItem=function(O,E,r,y,A){if(!O)throw new Error("Invalid parameters; name is required.");var n=Object.keys(this.items).length+1;this.items["item_"+n]={name:O,quantity:E||0,unit_price:r||0,total_price:y||0},A&&(this.items["item_"+n].description=A)},U.prototype.addTax=function(O,E){if(!(O&&typeof O=="string"&&typeof Number(E)=="number"))throw new Error("Invalid parameters.");var r=Object.keys(this.taxes).length+1;this.taxes["tax_"+r]={name:O,amount:Number(E)}},U.prototype.addChannel=function(O){if(!(O&&typeof O=="string"))throw new Error("Invalid parameters.");this.channels.push(O)},U.prototype.addChannels=function(O){if(!(O&&O instanceof Array))throw new Error("Invalid parameters.");this.channels=[];for(var E=0;E<O.length;E++)this.channels.push(O[E])},U.prototype.addCustomData=function(O,E){if(!(O&&E))throw new Error("Invalid parameters.");this.customData[O]=E},U.prototype.generateRequestBody=function(){if(!(this.store&&this.store.name&&this.baseURL&&this.totalAmount>0))throw new Error(`Invalid parameters. Initialize Invoice with valid instances of Setup and Store. Total amount must also be set.
eg: var invoice = new Invoice; invoice.init(setup, store); invoice.setTotalAmount(40)`);var O={invoice:{total_amount:this.totalAmount},store:this.store};return this.description&&(O.invoice.description=this.description),Object.keys(this.channels).length>0&&(O.invoice.channels=this.channels),Object.keys(this.items).length>0&&(O.invoice.items=this.items),(this.returnURL||this.cancelURL||this.callbackURL)&&(O.actions={},this.returnURL&&(O.actions.return_url=this.returnURL),this.cancelURL&&(O.actions.cancel_url=this.cancelURL),this.callbackURL&&(O.actions.callback_url=this.callbackURL)),Object.keys(this.taxes).length>0&&(O.invoice.taxes=this.taxes),Object.keys(this.customData).length>0&&(O.custom_data=this.customData),O},et=U,et}var rt,vt;function Ht(){if(vt)return rt;vt=1,rt=U;function U(E){if(E)return O(E)}function O(E){for(var r in U.prototype)E[r]=U.prototype[r];return E}return U.prototype.on=U.prototype.addEventListener=function(E,r){return this._callbacks=this._callbacks||{},(this._callbacks[E]=this._callbacks[E]||[]).push(r),this},U.prototype.once=function(E,r){var y=this;this._callbacks=this._callbacks||{};function A(){y.off(E,A),r.apply(this,arguments)}return A.fn=r,this.on(E,A),this},U.prototype.off=U.prototype.removeListener=U.prototype.removeAllListeners=U.prototype.removeEventListener=function(E,r){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var y=this._callbacks[E];if(!y)return this;if(arguments.length==1)return delete this._callbacks[E],this;for(var A,n=0;n<y.length;n++)if(A=y[n],A===r||A.fn===r){y.splice(n,1);break}return this},U.prototype.emit=function(E){this._callbacks=this._callbacks||{};var r=[].slice.call(arguments,1),y=this._callbacks[E];if(y){y=y.slice(0);for(var A=0,n=y.length;A<n;++A)y[A].apply(this,r)}return this},U.prototype.listeners=function(E){return this._callbacks=this._callbacks||{},this._callbacks[E]||[]},U.prototype.hasListeners=function(E){return!!this.listeners(E).length},rt}var nt,_t;function Vt(){return _t||(_t=1,nt=function(U,O,E){for(var r=0,y=U.length,A=arguments.length==3?E:U[r++];r<y;)A=O.call(null,A,U[r],++r,U);return A}),nt}var X,mt;function ct(){if(mt)return X;mt=1;var U=Ht(),O=Vt(),E=typeof window>"u"?X:window;function r(){}function y(t){var e={}.toString.call(t);switch(e){case"[object File]":case"[object Blob]":case"[object FormData]":return!0;default:return!1}}function A(){if(E.XMLHttpRequest&&(E.location.protocol!="file:"||!E.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch{}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch{}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch{}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch{}return!1}var n="".trim?function(t){return t.trim()}:function(t){return t.replace(/(^\s*|\s*$)/g,"")};function b(t){return t===Object(t)}function v(t){if(!b(t))return t;var e=[];for(var l in t)t[l]!=null&&e.push(encodeURIComponent(l)+"="+encodeURIComponent(t[l]));return e.join("&")}o.serializeObject=v;function d(t){for(var e={},l=t.split("&"),s,w,R=0,g=l.length;R<g;++R)w=l[R],s=w.split("="),e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]);return e}o.parseString=d,o.types={html:"text/html",json:"application/json",xml:"application/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},o.serialize={"application/x-www-form-urlencoded":v,"application/json":JSON.stringify},o.parse={"application/x-www-form-urlencoded":d,"application/json":JSON.parse};function h(t){var e=t.split(/\r?\n/),l={},s,w,R,g;e.pop();for(var j=0,k=e.length;j<k;++j)w=e[j],s=w.indexOf(":"),R=w.slice(0,s).toLowerCase(),g=n(w.slice(s+1)),l[R]=g;return l}function _(t){return t.split(/ *; */).shift()}function m(t){return O(t.split(/ *; */),function(e,l){var s=l.split(/ *= */),w=s.shift(),R=s.shift();return w&&R&&(e[w]=R),e},{})}function f(t,e){this.req=t,this.xhr=this.req.xhr,this.text=this.xhr.responseText,this.setStatusProperties(this.xhr.status),this.header=this.headers=h(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this.setHeaderProperties(this.header),this.body=this.req.method!="HEAD"?this.parseBody(this.text):null}f.prototype.get=function(t){return this.header[t.toLowerCase()]},f.prototype.setHeaderProperties=function(t){var e=this.header["content-type"]||"";this.type=_(e);var l=m(e);for(var s in l)this[s]=l[s]},f.prototype.parseBody=function(t){var e=o.parse[this.type];return e?e(t):null},f.prototype.setStatusProperties=function(t){var e=t/100|0;this.status=t,this.statusType=e,this.info=e==1,this.ok=e==2,this.clientError=e==4,this.serverError=e==5,this.error=e==4||e==5?this.toError():!1,this.accepted=t==202,this.noContent=t==204||t==1223,this.badRequest=t==400,this.unauthorized=t==401,this.notAcceptable=t==406,this.notFound=t==404,this.forbidden=t==403},f.prototype.toError=function(){var t=this.req,e=t.method,l=t.url,s="cannot "+e+" "+l+" ("+this.status+")",w=new Error(s);return w.status=this.status,w.method=e,w.url=l,w},o.Response=f;function u(t,e){var l=this;U.call(this),this._query=this._query||[],this.method=t,this.url=e,this.header={},this._header={},this.on("end",function(){var s=new f(l);t=="HEAD"&&(s.text=null),l.callback(null,s)})}U(u.prototype),u.prototype.use=function(t){return t(this),this},u.prototype.timeout=function(t){return this._timeout=t,this},u.prototype.clearTimeout=function(){return this._timeout=0,clearTimeout(this._timer),this},u.prototype.abort=function(){if(!this.aborted)return this.aborted=!0,this.xhr.abort(),this.clearTimeout(),this.emit("abort"),this},u.prototype.set=function(t,e){if(b(t)){for(var l in t)this.set(l,t[l]);return this}return this._header[t.toLowerCase()]=e,this.header[t]=e,this},u.prototype.getHeader=function(t){return this._header[t.toLowerCase()]},u.prototype.type=function(t){return this.set("Content-Type",o.types[t]||t),this},u.prototype.accept=function(t){return this.set("Accept",o.types[t]||t),this},u.prototype.auth=function(t,e){var l=btoa(t+":"+e);return this.set("Authorization","Basic "+l),this},u.prototype.query=function(t){return typeof t!="string"&&(t=v(t)),t&&this._query.push(t),this},u.prototype.field=function(t,e){return this._formData||(this._formData=new FormData),this._formData.append(t,e),this},u.prototype.attach=function(t,e,l){return this._formData||(this._formData=new FormData),this._formData.append(t,e,l),this},u.prototype.send=function(t){var e=b(t),l=this.getHeader("Content-Type");if(e&&b(this._data))for(var s in t)this._data[s]=t[s];else typeof t=="string"?(l||this.type("form"),l=this.getHeader("Content-Type"),l=="application/x-www-form-urlencoded"?this._data=this._data?this._data+"&"+t:t:this._data=(this._data||"")+t):this._data=t;return e?(l||this.type("json"),this):this},u.prototype.callback=function(t,e){var l=this._callback;if(l.length==2)return l(t,e);if(t)return this.emit("error",t);l(e)},u.prototype.crossDomainError=function(){var t=new Error("Origin is not allowed by Access-Control-Allow-Origin");t.crossDomain=!0,this.callback(t)},u.prototype.timeoutError=function(){var t=this._timeout,e=new Error("timeout of "+t+"ms exceeded");e.timeout=t,this.callback(e)},u.prototype.withCredentials=function(){return this._withCredentials=!0,this},u.prototype.end=function(t){var e=this,l=this.xhr=A(),s=this._query.join("&"),w=this._timeout,R=this._formData||this._data;if(this._callback=t||r,l.onreadystatechange=function(){if(l.readyState==4){if(l.status==0)return e.aborted?e.timeoutError():e.crossDomainError();e.emit("end")}},l.upload&&(l.upload.onprogress=function(k){k.percent=k.loaded/k.total*100,e.emit("progress",k)}),w&&!this._timer&&(this._timer=setTimeout(function(){e.abort()},w)),s&&(s=o.serializeObject(s),this.url+=~this.url.indexOf("?")?"&"+s:"?"+s),l.open(this.method,this.url,!0),this._withCredentials&&(l.withCredentials=!0),this.method!="GET"&&this.method!="HEAD"&&typeof R!="string"&&!y(R)){var g=o.serialize[this.getHeader("Content-Type")];g&&(R=g(R))}for(var j in this.header)this.header[j]!=null&&l.setRequestHeader(j,this.header[j]);return this.emit("request",this),l.send(R),this},o.Request=u;function o(t,e){return typeof e=="function"?new u("GET",t).end(e):arguments.length==1?new u("GET",t):new u(t,e)}return o.get=function(t,e,l){var s=o("GET",t);return typeof e=="function"&&(l=e,e=null),e&&s.query(e),l&&s.end(l),s},o.head=function(t,e,l){var s=o("HEAD",t);return typeof e=="function"&&(l=e,e=null),e&&s.send(e),l&&s.end(l),s},o.del=function(t,e){var l=o("DELETE",t);return e&&l.end(e),l},o.patch=function(t,e,l){var s=o("PATCH",t);return typeof e=="function"&&(l=e,e=null),e&&s.send(e),l&&s.end(l),s},o.post=function(t,e,l){var s=o("POST",t);return typeof e=="function"&&(l=e,e=null),e&&s.send(e),l&&s.end(l),s},o.put=function(t,e,l){var s=o("PUT",t);return typeof e=="function"&&(l=e,e=null),e&&s.send(e),l&&s.end(l),s},X=o,X}var it={exports:{}},yt;function ut(){return yt||(yt=1,(function(U,O){var E={};/* @preserve
 * The MIT License (MIT)
 * 
 * Copyright (c) 2013-2015 Petka Antonov
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 * 
 */(function(r){U.exports=r()})(function(){return(function r(y,A,n){function b(h,_){if(!A[h]){if(!y[h]){var m=typeof _dereq_=="function"&&_dereq_;if(!_&&m)return m(h,!0);if(v)return v(h,!0);var f=new Error("Cannot find module '"+h+"'");throw f.code="MODULE_NOT_FOUND",f}var u=A[h]={exports:{}};y[h][0].call(u.exports,function(o){var t=y[h][1][o];return b(t||o)},u,u.exports,r,y,A,n)}return A[h].exports}for(var v=typeof _dereq_=="function"&&_dereq_,d=0;d<n.length;d++)b(n[d]);return b})({1:[function(r,y,A){y.exports=function(n){var b=n._SomePromiseArray;function v(d){var h=new b(d),_=h.promise();return h.setHowMany(1),h.setUnwrap(),h.init(),_}n.any=function(d){return v(d)},n.prototype.any=function(){return v(this)}}},{}],2:[function(r,y,A){var n;try{throw new Error}catch(u){n=u}var b=r("./schedule.js"),v=r("./queue.js"),d=r("./util.js");function h(){this._isTickUsed=!1,this._lateQueue=new v(16),this._normalQueue=new v(16),this._trampolineEnabled=!0;var u=this;this.drainQueues=function(){u._drainQueues()},this._schedule=b.isStatic?b(this.drainQueues):b}h.prototype.disableTrampolineIfNecessary=function(){d.hasDevTools&&(this._trampolineEnabled=!1)},h.prototype.enableTrampoline=function(){this._trampolineEnabled||(this._trampolineEnabled=!0,this._schedule=function(u){setTimeout(u,0)})},h.prototype.haveItemsQueued=function(){return this._normalQueue.length()>0},h.prototype.throwLater=function(u,o){if(arguments.length===1&&(o=u,u=function(){throw o}),typeof setTimeout<"u")setTimeout(function(){u(o)},0);else try{this._schedule(function(){u(o)})}catch{throw new Error(`No async scheduler available

    See http://goo.gl/m3OTXk
`)}};function _(u,o,t){this._lateQueue.push(u,o,t),this._queueTick()}function m(u,o,t){this._normalQueue.push(u,o,t),this._queueTick()}function f(u){this._normalQueue._pushOne(u),this._queueTick()}d.hasDevTools?(b.isStatic&&(b=function(u){setTimeout(u,0)}),h.prototype.invokeLater=function(u,o,t){this._trampolineEnabled?_.call(this,u,o,t):this._schedule(function(){setTimeout(function(){u.call(o,t)},100)})},h.prototype.invoke=function(u,o,t){this._trampolineEnabled?m.call(this,u,o,t):this._schedule(function(){u.call(o,t)})},h.prototype.settlePromises=function(u){this._trampolineEnabled?f.call(this,u):this._schedule(function(){u._settlePromises()})}):(h.prototype.invokeLater=_,h.prototype.invoke=m,h.prototype.settlePromises=f),h.prototype.invokeFirst=function(u,o,t){this._normalQueue.unshift(u,o,t),this._queueTick()},h.prototype._drainQueue=function(u){for(;u.length()>0;){var o=u.shift();if(typeof o!="function"){o._settlePromises();continue}var t=u.shift(),e=u.shift();o.call(t,e)}},h.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._drainQueue(this._lateQueue)},h.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},h.prototype._reset=function(){this._isTickUsed=!1},y.exports=new h,y.exports.firstLineError=n},{"./queue.js":28,"./schedule.js":31,"./util.js":38}],3:[function(r,y,A){y.exports=function(n,b,v){var d=function(f,u){this._reject(u)},h=function(f,u){u.promiseRejectionQueued=!0,u.bindingPromise._then(d,d,null,this,f)},_=function(f,u){this._isPending()&&this._resolveCallback(u.target)},m=function(f,u){u.promiseRejectionQueued||this._reject(f)};n.prototype.bind=function(f){var u=v(f),o=new n(b);o._propagateFrom(this,1);var t=this._target();if(o._setBoundTo(u),u instanceof n){var e={promiseRejectionQueued:!1,promise:o,target:t,bindingPromise:u};t._then(b,h,o._progress,o,e),u._then(_,m,o._progress,o,e)}else o._resolveCallback(t);return o},n.prototype._setBoundTo=function(f){f!==void 0?(this._bitField=this._bitField|131072,this._boundTo=f):this._bitField=this._bitField&-131073},n.prototype._isBound=function(){return(this._bitField&131072)===131072},n.bind=function(f,u){var o=v(f),t=new n(b);return t._setBoundTo(o),o instanceof n?o._then(function(){t._resolveCallback(u)},t._reject,t._progress,t,null):t._resolveCallback(u),t}}},{}],4:[function(r,y,A){var n;typeof Promise<"u"&&(n=Promise);function b(){try{Promise===v&&(Promise=n)}catch{}return v}var v=r("./promise.js")();v.noConflict=b,y.exports=v},{"./promise.js":23}],5:[function(r,y,A){var n=Object.create;if(n){var b=n(null),v=n(null);b[" size"]=v[" size"]=0}y.exports=function(d){var h=r("./util.js"),_=h.canEvaluate;h.isIdentifier;var m;function f(e,l){var s;if(e!=null&&(s=e[l]),typeof s!="function"){var w="Object "+h.classString(e)+" has no method '"+h.toString(l)+"'";throw new d.TypeError(w)}return s}function u(e){var l=this.pop(),s=f(e,l);return s.apply(e,this)}d.prototype.call=function(e){for(var l=arguments.length,s=new Array(l-1),w=1;w<l;++w)s[w-1]=arguments[w];return s.push(e),this._then(u,void 0,void 0,s,void 0)};function o(e){return e[this]}function t(e){var l=+this;return l<0&&(l=Math.max(0,l+e.length)),e[l]}d.prototype.get=function(e){var l=typeof e=="number",s;if(l)s=t;else if(_){var w=m(e);s=w!==null?w:o}else s=o;return this._then(s,void 0,void 0,e,void 0)}}},{"./util.js":38}],6:[function(r,y,A){y.exports=function(n){var b=r("./errors.js"),v=r("./async.js"),d=b.CancellationError;n.prototype._cancel=function(h){if(!this.isCancellable())return this;for(var _,m=this;(_=m._cancellationParent)!==void 0&&_.isCancellable();)m=_;this._unsetCancellable(),m._target()._rejectCallback(h,!1,!0)},n.prototype.cancel=function(h){return this.isCancellable()?(h===void 0&&(h=new d),v.invokeLater(this._cancel,this,h),this):this},n.prototype.cancellable=function(){return this._cancellable()?this:(v.enableTrampoline(),this._setCancellable(),this._cancellationParent=void 0,this)},n.prototype.uncancellable=function(){var h=this.then();return h._unsetCancellable(),h},n.prototype.fork=function(h,_,m){var f=this._then(h,_,m,void 0,void 0);return f._setCancellable(),f._cancellationParent=void 0,f}}},{"./async.js":2,"./errors.js":13}],7:[function(r,y,A){y.exports=function(){var n=r("./async.js"),b=r("./util.js"),v=/[\\\/]bluebird[\\\/]js[\\\/](main|debug|zalgo|instrumented)/,d=null,h=null,_=!1,m;function f(T){this._parent=T;var i=this._length=1+(T===void 0?0:T._length);k(this,f),i>32&&this.uncycle()}b.inherits(f,Error),f.prototype.uncycle=function(){var T=this._length;if(!(T<2)){for(var i=[],P={},a=0,c=this;c!==void 0;++a)i.push(c),c=c._parent;T=this._length=a;for(var a=T-1;a>=0;--a){var C=i[a].stack;P[C]===void 0&&(P[C]=a)}for(var a=0;a<T;++a){var N=i[a].stack,F=P[N];if(F!==void 0&&F!==a){F>0&&(i[F-1]._parent=void 0,i[F-1]._length=1),i[a]._parent=void 0,i[a]._length=1;var L=a>0?i[a-1]:this;F<T-1?(L._parent=i[F+1],L._parent.uncycle(),L._length=L._parent._length+1):(L._parent=void 0,L._length=1);for(var x=L._length+1,I=a-2;I>=0;--I)i[I]._length=x,x++;return}}}},f.prototype.parent=function(){return this._parent},f.prototype.hasParent=function(){return this._parent!==void 0},f.prototype.attachExtraTrace=function(T){if(!T.__stackCleaned__){this.uncycle();for(var i=f.parseStackAndMessage(T),P=i.message,a=[i.stack],c=this;c!==void 0;)a.push(e(c.stack.split(`
`))),c=c._parent;t(a),o(a),b.notEnumerableProp(T,"stack",u(P,a)),b.notEnumerableProp(T,"__stackCleaned__",!0)}};function u(T,i){for(var P=0;P<i.length-1;++P)i[P].push("From previous event:"),i[P]=i[P].join(`
`);return P<i.length&&(i[P]=i[P].join(`
`)),T+`
`+i.join(`
`)}function o(T){for(var i=0;i<T.length;++i)(T[i].length===0||i+1<T.length&&T[i][0]===T[i+1][0])&&(T.splice(i,1),i--)}function t(T){for(var i=T[0],P=1;P<T.length;++P){for(var a=T[P],c=i.length-1,C=i[c],N=-1,F=a.length-1;F>=0;--F)if(a[F]===C){N=F;break}for(var F=N;F>=0;--F){var L=a[F];if(i[c]===L)i.pop(),c--;else break}i=a}}function e(T){for(var i=[],P=0;P<T.length;++P){var a=T[P],c=d.test(a)||a==="    (No stack trace)",C=c&&R(a);c&&!C&&(_&&a.charAt(0)!==" "&&(a="    "+a),i.push(a))}return i}function l(T){for(var i=T.stack.replace(/\s+$/g,"").split(`
`),P=0;P<i.length;++P){var a=i[P];if(a==="    (No stack trace)"||d.test(a))break}return P>0&&(i=i.slice(P)),i}f.parseStackAndMessage=function(T){var i=T.stack,P=T.toString();return i=typeof i=="string"&&i.length>0?l(T):["    (No stack trace)"],{message:P,stack:e(i)}},f.formatAndLogError=function(T,i){if(typeof console<"u"){var P;if(typeof T=="object"||typeof T=="function"){var a=T.stack;P=i+h(a,T)}else P=i+String(T);typeof m=="function"?m(P):(typeof console.log=="function"||typeof console.log=="object")&&console.log(P)}},f.unhandledRejection=function(T){f.formatAndLogError(T,"^--- With additional stack trace: ")},f.isSupported=function(){return typeof k=="function"},f.fireRejectionEvent=function(T,i,P,a){var c=!1;try{typeof i=="function"&&(c=!0,T==="rejectionHandled"?i(a):i(P,a))}catch(F){n.throwLater(F)}var C=!1;try{C=D(T,P,a)}catch(F){C=!0,n.throwLater(F)}var N=!1;if(S)try{N=S(T.toLowerCase(),{reason:P,promise:a})}catch(F){N=!0,n.throwLater(F)}!C&&!c&&!N&&T==="unhandledRejection"&&f.formatAndLogError(P,"Unhandled rejection ")};function s(T){var i;if(typeof T=="function")i="[function "+(T.name||"anonymous")+"]";else{i=T.toString();var P=/\[object [a-zA-Z0-9$_]+\]/;if(P.test(i))try{var a=JSON.stringify(T);i=a}catch{}i.length===0&&(i="(empty array)")}return"(<"+w(i)+">, no stack trace)"}function w(T){var i=41;return T.length<i?T:T.substr(0,i-3)+"..."}var R=function(){return!1},g=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;function j(T){var i=T.match(g);if(i)return{fileName:i[1],line:parseInt(i[2],10)}}f.setBounds=function(T,i){if(f.isSupported()){for(var P=T.stack.split(`
`),a=i.stack.split(`
`),c=-1,C=-1,N,F,L=0;L<P.length;++L){var x=j(P[L]);if(x){N=x.fileName,c=x.line;break}}for(var L=0;L<a.length;++L){var x=j(a[L]);if(x){F=x.fileName,C=x.line;break}}c<0||C<0||!N||!F||N!==F||c>=C||(R=function(I){if(v.test(I))return!0;var H=j(I);return!!(H&&H.fileName===N&&c<=H.line&&H.line<=C)})}};var k=(function(){var i=/^\s*at\s*/,P=function(N,F){return typeof N=="string"?N:F.name!==void 0&&F.message!==void 0?F.toString():s(F)};if(typeof Error.stackTraceLimit=="number"&&typeof Error.captureStackTrace=="function"){Error.stackTraceLimit=Error.stackTraceLimit+6,d=i,h=P;var a=Error.captureStackTrace;return R=function(N){return v.test(N)},function(N,F){Error.stackTraceLimit=Error.stackTraceLimit+6,a(N,F),Error.stackTraceLimit=Error.stackTraceLimit-6}}var c=new Error;if(typeof c.stack=="string"&&c.stack.split(`
`)[0].indexOf("stackDetection@")>=0)return d=/@/,h=P,_=!0,function(F){F.stack=new Error().stack};var C;try{throw new Error}catch(N){C="stack"in N}return!("stack"in c)&&C&&typeof Error.stackTraceLimit=="number"?(d=i,h=P,function(F){Error.stackTraceLimit=Error.stackTraceLimit+6;try{throw new Error}catch(L){F.stack=L.stack}Error.stackTraceLimit=Error.stackTraceLimit-6}):(h=function(N,F){return typeof N=="string"?N:(typeof F=="object"||typeof F=="function")&&F.name!==void 0&&F.message!==void 0?F.toString():s(F)},null)})(),S,D=(function(){if(b.isNode)return function(C,N,F){return C==="rejectionHandled"?process.emit(C,F):process.emit(C,N,F)};var T=!1,i=!0;try{var P=new self.CustomEvent("test");T=P instanceof CustomEvent}catch{}if(!T)try{var a=document.createEvent("CustomEvent");a.initCustomEvent("testingtheevent",!1,!0,{}),self.dispatchEvent(a)}catch{i=!1}i&&(S=function(C,N){var F;return T?F=new self.CustomEvent(C,{detail:N,bubbles:!1,cancelable:!0}):self.dispatchEvent&&(F=document.createEvent("CustomEvent"),F.initCustomEvent(C,!1,!0,N)),F?!self.dispatchEvent(F):!1});var c={};return c.unhandledRejection="onunhandledRejection".toLowerCase(),c.rejectionHandled="onrejectionHandled".toLowerCase(),function(C,N,F){var L=c[C],x=self[L];return x?(C==="rejectionHandled"?x.call(self,F):x.call(self,N,F),!0):!1}})();return typeof console<"u"&&typeof console.warn<"u"&&(m=function(T){console.warn(T)},b.isNode&&process.stderr.isTTY?m=function(T){process.stderr.write("\x1B[31m"+T+`\x1B[39m
`)}:!b.isNode&&typeof new Error().stack=="string"&&(m=function(T){console.warn("%c"+T,"color: red")})),f}},{"./async.js":2,"./util.js":38}],8:[function(r,y,A){y.exports=function(n){var b=r("./util.js"),v=r("./errors.js"),d=b.tryCatch,h=b.errorObj,_=r("./es5.js").keys,m=v.TypeError;function f(o,t,e){this._instances=o,this._callback=t,this._promise=e}function u(o,t){var e={},l=d(o).call(e,t);if(l===h)return l;var s=_(e);return s.length?(h.e=new m(`Catch filter must inherit from Error or be a simple predicate function

    See http://goo.gl/o84o68
`),h):l}return f.prototype.doFilter=function(o){for(var t=this._callback,e=this._promise,l=e._boundValue(),s=0,w=this._instances.length;s<w;++s){var R=this._instances[s],g=R===Error||R!=null&&R.prototype instanceof Error;if(g&&o instanceof R){var j=d(t).call(l,o);return j===h?(n.e=j.e,n):j}else if(typeof R=="function"&&!g){var k=u(R,o);if(k===h){o=h.e;break}else if(k){var j=d(t).call(l,o);return j===h?(n.e=j.e,n):j}}}return n.e=o,n},f}},{"./errors.js":13,"./es5.js":14,"./util.js":38}],9:[function(r,y,A){y.exports=function(n,b,v){var d=[];function h(){this._trace=new b(m())}h.prototype._pushContext=function(){v()&&this._trace!==void 0&&d.push(this._trace)},h.prototype._popContext=function(){v()&&this._trace!==void 0&&d.pop()};function _(){if(v())return new h}function m(){var f=d.length-1;if(f>=0)return d[f]}return n.prototype._peekContext=m,n.prototype._pushContext=h.prototype._pushContext,n.prototype._popContext=h.prototype._popContext,_}},{}],10:[function(r,y,A){y.exports=function(n,b){var v=n._getDomain,d=r("./async.js"),h=r("./errors.js").Warning,_=r("./util.js"),m=_.canAttachTrace,f,u,o=_.isNode&&(!!E.BLUEBIRD_DEBUG||!1);return _.isNode&&E.BLUEBIRD_DEBUG==0&&(o=!1),o&&d.disableTrampolineIfNecessary(),n.prototype._ignoreRejections=function(){this._unsetRejectionIsUnhandled(),this._bitField=this._bitField|16777216},n.prototype._ensurePossibleRejectionHandled=function(){(this._bitField&16777216)===0&&(this._setRejectionIsUnhandled(),d.invokeLater(this._notifyUnhandledRejection,this,void 0))},n.prototype._notifyUnhandledRejectionIsHandled=function(){b.fireRejectionEvent("rejectionHandled",f,void 0,this)},n.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var t=this._getCarriedStackTrace()||this._settledValue;this._setUnhandledRejectionIsNotified(),b.fireRejectionEvent("unhandledRejection",u,t,this)}},n.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=this._bitField|524288},n.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=this._bitField&-524289},n.prototype._isUnhandledRejectionNotified=function(){return(this._bitField&524288)>0},n.prototype._setRejectionIsUnhandled=function(){this._bitField=this._bitField|2097152},n.prototype._unsetRejectionIsUnhandled=function(){this._bitField=this._bitField&-2097153,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},n.prototype._isRejectionUnhandled=function(){return(this._bitField&2097152)>0},n.prototype._setCarriedStackTrace=function(t){this._bitField=this._bitField|1048576,this._fulfillmentHandler0=t},n.prototype._isCarryingStackTrace=function(){return(this._bitField&1048576)>0},n.prototype._getCarriedStackTrace=function(){return this._isCarryingStackTrace()?this._fulfillmentHandler0:void 0},n.prototype._captureStackTrace=function(){return o&&(this._trace=new b(this._peekContext())),this},n.prototype._attachExtraTrace=function(t,e){if(o&&m(t)){var l=this._trace;if(l!==void 0&&e&&(l=l._parent),l!==void 0)l.attachExtraTrace(t);else if(!t.__stackCleaned__){var s=b.parseStackAndMessage(t);_.notEnumerableProp(t,"stack",s.message+`
`+s.stack.join(`
`)),_.notEnumerableProp(t,"__stackCleaned__",!0)}}},n.prototype._warn=function(t){var e=new h(t),l=this._peekContext();if(l)l.attachExtraTrace(e);else{var s=b.parseStackAndMessage(e);e.stack=s.message+`
`+s.stack.join(`
`)}b.formatAndLogError(e,"")},n.onPossiblyUnhandledRejection=function(t){var e=v();u=typeof t=="function"?e===null?t:e.bind(t):void 0},n.onUnhandledRejectionHandled=function(t){var e=v();f=typeof t=="function"?e===null?t:e.bind(t):void 0},n.longStackTraces=function(){if(d.haveItemsQueued()&&o===!1)throw new Error(`cannot enable long stack traces after promises have been created

    See http://goo.gl/DT1qyG
`);o=b.isSupported(),o&&d.disableTrampolineIfNecessary()},n.hasLongStackTraces=function(){return o&&b.isSupported()},b.isSupported()||(n.longStackTraces=function(){},o=!1),function(){return o}}},{"./async.js":2,"./errors.js":13,"./util.js":38}],11:[function(r,y,A){var n=r("./util.js"),b=n.isPrimitive;y.exports=function(v){var d=function(){return this},h=function(){throw this},_=function(){},m=function(){throw void 0},f=function(u,o){if(o===1)return function(){throw u};if(o===2)return function(){return u}};v.prototype.return=v.prototype.thenReturn=function(u){return u===void 0?this.then(_):b(u)?this._then(f(u,2),void 0,void 0,void 0,void 0):(u instanceof v&&u._ignoreRejections(),this._then(d,void 0,void 0,u,void 0))},v.prototype.throw=v.prototype.thenThrow=function(u){return u===void 0?this.then(m):b(u)?this._then(f(u,1),void 0,void 0,void 0,void 0):this._then(h,void 0,void 0,u,void 0)}}},{"./util.js":38}],12:[function(r,y,A){y.exports=function(n,b){var v=n.reduce;n.prototype.each=function(d){return v(this,d,null,b)},n.each=function(d,h){return v(d,h,null,b)}}},{}],13:[function(r,y,A){var n=r("./es5.js"),b=n.freeze,v=r("./util.js"),d=v.inherits,h=v.notEnumerableProp;function _(j,k){function S(D){if(!(this instanceof S))return new S(D);h(this,"message",typeof D=="string"?D:k),h(this,"name",j),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)}return d(S,Error),S}var m,f,u=_("Warning","warning"),o=_("CancellationError","cancellation error"),t=_("TimeoutError","timeout error"),e=_("AggregateError","aggregate error");try{m=TypeError,f=RangeError}catch{m=_("TypeError","type error"),f=_("RangeError","range error")}for(var l="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),s=0;s<l.length;++s)typeof Array.prototype[l[s]]=="function"&&(e.prototype[l[s]]=Array.prototype[l[s]]);n.defineProperty(e.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),e.prototype.isOperational=!0;var w=0;e.prototype.toString=function(){var j=Array(w*4+1).join(" "),k=`
`+j+`AggregateError of:
`;w++,j=Array(w*4+1).join(" ");for(var S=0;S<this.length;++S){for(var D=this[S]===this?"[Circular AggregateError]":this[S]+"",T=D.split(`
`),i=0;i<T.length;++i)T[i]=j+T[i];D=T.join(`
`),k+=D+`
`}return w--,k};function R(j){if(!(this instanceof R))return new R(j);h(this,"name","OperationalError"),h(this,"message",j),this.cause=j,this.isOperational=!0,j instanceof Error?(h(this,"message",j.message),h(this,"stack",j.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}d(R,Error);var g=Error.__BluebirdErrorTypes__;g||(g=b({CancellationError:o,TimeoutError:t,OperationalError:R,RejectionError:R,AggregateError:e}),h(Error,"__BluebirdErrorTypes__",g)),y.exports={Error,TypeError:m,RangeError:f,CancellationError:g.CancellationError,OperationalError:g.OperationalError,TimeoutError:g.TimeoutError,AggregateError:g.AggregateError,Warning:u}},{"./es5.js":14,"./util.js":38}],14:[function(r,y,A){var n=(function(){return this===void 0})();if(n)y.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:n,propertyIsWritable:function(t,e){var l=Object.getOwnPropertyDescriptor(t,e);return!!(!l||l.writable||l.set)}};else{var b={}.hasOwnProperty,v={}.toString,d={}.constructor.prototype,h=function(t){var e=[];for(var l in t)b.call(t,l)&&e.push(l);return e},_=function(t,e){return{value:t[e]}},m=function(t,e,l){return t[e]=l.value,t},f=function(t){return t},u=function(t){try{return Object(t).constructor.prototype}catch{return d}},o=function(t){try{return v.call(t)==="[object Array]"}catch{return!1}};y.exports={isArray:o,keys:h,names:h,defineProperty:m,getDescriptor:_,freeze:f,getPrototypeOf:u,isES5:n,propertyIsWritable:function(){return!0}}}},{}],15:[function(r,y,A){y.exports=function(n,b){var v=n.map;n.prototype.filter=function(d,h){return v(this,d,h,b)},n.filter=function(d,h,_){return v(d,h,_,b)}}},{}],16:[function(r,y,A){y.exports=function(n,b,v){var d=r("./util.js"),h=d.isPrimitive,_=d.thrower;function m(){return this}function f(){throw this}function u(s){return function(){return s}}function o(s){return function(){throw s}}function t(s,w,R){var g;return h(w)?g=R?u(w):o(w):g=R?m:f,s._then(g,_,void 0,w,void 0)}function e(s){var w=this.promise,R=this.handler,g=w._isBound()?R.call(w._boundValue()):R();if(g!==void 0){var j=v(g,w);if(j instanceof n)return j=j._target(),t(j,s,w.isFulfilled())}return w.isRejected()?(b.e=s,b):s}function l(s){var w=this.promise,R=this.handler,g=w._isBound()?R.call(w._boundValue(),s):R(s);if(g!==void 0){var j=v(g,w);if(j instanceof n)return j=j._target(),t(j,s,!0)}return s}n.prototype._passThroughHandler=function(s,w){if(typeof s!="function")return this.then();var R={promise:this,handler:s};return this._then(w?e:l,w?e:void 0,void 0,R,void 0)},n.prototype.lastly=n.prototype.finally=function(s){return this._passThroughHandler(s,!0)},n.prototype.tap=function(s){return this._passThroughHandler(s,!1)}}},{"./util.js":38}],17:[function(r,y,A){y.exports=function(n,b,v,d){var h=r("./errors.js"),_=h.TypeError,m=r("./util.js"),f=m.errorObj,u=m.tryCatch,o=[];function t(l,s,w){for(var R=0;R<s.length;++R){w._pushContext();var g=u(s[R])(l);if(w._popContext(),g===f){w._pushContext();var j=n.reject(f.e);return w._popContext(),j}var k=d(g,w);if(k instanceof n)return k}return null}function e(l,s,w,R){var g=this._promise=new n(v);g._captureStackTrace(),this._stack=R,this._generatorFunction=l,this._receiver=s,this._generator=void 0,this._yieldHandlers=typeof w=="function"?[w].concat(o):o}e.prototype.promise=function(){return this._promise},e.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._next(void 0)},e.prototype._continue=function(l){if(l===f)return this._promise._rejectCallback(l.e,!1,!0);var s=l.value;if(l.done===!0)this._promise._resolveCallback(s);else{var w=d(s,this._promise);if(!(w instanceof n)&&(w=t(w,this._yieldHandlers,this._promise),w===null)){this._throw(new _(`A value %s was yielded that could not be treated as a promise

    See http://goo.gl/4Y4pDk

`.replace("%s",s)+`From coroutine:
`+this._stack.split(`
`).slice(1,-7).join(`
`)));return}w._then(this._next,this._throw,void 0,this,null)}},e.prototype._throw=function(l){this._promise._attachExtraTrace(l),this._promise._pushContext();var s=u(this._generator.throw).call(this._generator,l);this._promise._popContext(),this._continue(s)},e.prototype._next=function(l){this._promise._pushContext();var s=u(this._generator.next).call(this._generator,l);this._promise._popContext(),this._continue(s)},n.coroutine=function(l,s){if(typeof l!="function")throw new _(`generatorFunction must be a function

    See http://goo.gl/6Vqhm0
`);var w=Object(s).yieldHandler,R=e,g=new Error().stack;return function(){var j=l.apply(this,arguments),k=new R(void 0,void 0,w,g);return k._generator=j,k._next(void 0),k.promise()}},n.coroutine.addYieldHandler=function(l){if(typeof l!="function")throw new _(`fn must be a function

    See http://goo.gl/916lJJ
`);o.push(l)},n.spawn=function(l){if(typeof l!="function")return b(`generatorFunction must be a function

    See http://goo.gl/6Vqhm0
`);var s=new e(l,this),w=s.promise();return s._run(n.spawn),w}}},{"./errors.js":13,"./util.js":38}],18:[function(r,y,A){y.exports=function(n,b,v,d){var h=r("./util.js");h.canEvaluate,h.tryCatch,h.errorObj,n.join=function(){var _=arguments.length-1,m;if(_>0&&typeof arguments[_]=="function"){m=arguments[_];var t}for(var f=arguments.length,u=new Array(f),o=0;o<f;++o)u[o]=arguments[o];m&&u.pop();var t=new b(u).promise();return m!==void 0?t.spread(m):t}}},{"./util.js":38}],19:[function(r,y,A){y.exports=function(n,b,v,d,h){var _=n._getDomain,m=r("./async.js"),f=r("./util.js"),u=f.tryCatch,o=f.errorObj,t={},e=[];function l(R,g,j,k){this.constructor$(R),this._promise._captureStackTrace();var S=_();this._callback=S===null?g:S.bind(g),this._preservedValues=k===h?new Array(this.length()):null,this._limit=j,this._inFlight=0,this._queue=j>=1?[]:e,m.invoke(s,this,void 0)}f.inherits(l,b);function s(){this._init$(void 0,-2)}l.prototype._init=function(){},l.prototype._promiseFulfilled=function(R,g){var j=this._values,k=this.length(),S=this._preservedValues,D=this._limit;if(j[g]===t){if(j[g]=R,D>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return}else{if(D>=1&&this._inFlight>=D){j[g]=R,this._queue.push(g);return}S!==null&&(S[g]=R);var T=this._callback,i=this._promise._boundValue();this._promise._pushContext();var P=u(T).call(i,R,g,k);if(this._promise._popContext(),P===o)return this._reject(P.e);var a=d(P,this._promise);if(a instanceof n){if(a=a._target(),a._isPending())return D>=1&&this._inFlight++,j[g]=t,a._proxyPromiseArray(this,g);if(a._isFulfilled())P=a._value();else return this._reject(a._reason())}j[g]=P}var c=++this._totalResolved;c>=k&&(S!==null?this._filter(j,S):this._resolve(j))},l.prototype._drainQueue=function(){for(var R=this._queue,g=this._limit,j=this._values;R.length>0&&this._inFlight<g;){if(this._isResolved())return;var k=R.pop();this._promiseFulfilled(j[k],k)}},l.prototype._filter=function(R,g){for(var j=g.length,k=new Array(j),S=0,D=0;D<j;++D)R[D]&&(k[S++]=g[D]);k.length=S,this._resolve(k)},l.prototype.preservedValues=function(){return this._preservedValues};function w(R,g,j,k){var S=typeof j=="object"&&j!==null?j.concurrency:0;return S=typeof S=="number"&&isFinite(S)&&S>=1?S:0,new l(R,g,S,k)}n.prototype.map=function(R,g){return typeof R!="function"?v(`fn must be a function

    See http://goo.gl/916lJJ
`):w(this,R,g,null).promise()},n.map=function(R,g,j,k){return typeof g!="function"?v(`fn must be a function

    See http://goo.gl/916lJJ
`):w(R,g,j,k).promise()}}},{"./async.js":2,"./util.js":38}],20:[function(r,y,A){y.exports=function(n,b,v,d){var h=r("./util.js"),_=h.tryCatch;n.method=function(m){if(typeof m!="function")throw new n.TypeError(`fn must be a function

    See http://goo.gl/916lJJ
`);return function(){var f=new n(b);f._captureStackTrace(),f._pushContext();var u=_(m).apply(this,arguments);return f._popContext(),f._resolveFromSyncValue(u),f}},n.attempt=n.try=function(m,f,u){if(typeof m!="function")return d(`fn must be a function

    See http://goo.gl/916lJJ
`);var o=new n(b);o._captureStackTrace(),o._pushContext();var t=h.isArray(f)?_(m).apply(u,f):_(m).call(u,f);return o._popContext(),o._resolveFromSyncValue(t),o},n.prototype._resolveFromSyncValue=function(m){m===h.errorObj?this._rejectCallback(m.e,!1,!0):this._resolveCallback(m,!0)}}},{"./util.js":38}],21:[function(r,y,A){y.exports=function(n){var b=r("./util.js"),v=r("./async.js"),d=b.tryCatch,h=b.errorObj;function _(u,o){var t=this;if(!b.isArray(u))return m.call(t,u,o);var e=d(o).apply(t._boundValue(),[null].concat(u));e===h&&v.throwLater(e.e)}function m(u,o){var t=this,e=t._boundValue(),l=u===void 0?d(o).call(e,null):d(o).call(e,null,u);l===h&&v.throwLater(l.e)}function f(u,o){var t=this;if(!u){var e=t._target(),l=e._getCarriedStackTrace();l.cause=u,u=l}var s=d(o).call(t._boundValue(),u);s===h&&v.throwLater(s.e)}n.prototype.asCallback=n.prototype.nodeify=function(u,o){if(typeof u=="function"){var t=m;o!==void 0&&Object(o).spread&&(t=_),this._then(t,f,void 0,this,u)}return this}}},{"./async.js":2,"./util.js":38}],22:[function(r,y,A){y.exports=function(n,b){var v=r("./util.js"),d=r("./async.js"),h=v.tryCatch,_=v.errorObj;n.prototype.progressed=function(m){return this._then(void 0,void 0,m,void 0,void 0)},n.prototype._progress=function(m){this._isFollowingOrFulfilledOrRejected()||this._target()._progressUnchecked(m)},n.prototype._progressHandlerAt=function(m){return m===0?this._progressHandler0:this[(m<<2)+m-5+2]},n.prototype._doProgressWith=function(m){var f=m.value,u=m.handler,o=m.promise,t=m.receiver,e=h(u).call(t,f);if(e===_){if(e.e!=null&&e.e.name!=="StopProgressPropagation"){var l=v.canAttachTrace(e.e)?e.e:new Error(v.toString(e.e));o._attachExtraTrace(l),o._progress(e.e)}}else e instanceof n?e._then(o._progress,null,null,o,void 0):o._progress(e)},n.prototype._progressUnchecked=function(m){for(var f=this._length(),u=this._progress,o=0;o<f;o++){var t=this._progressHandlerAt(o),e=this._promiseAt(o);if(!(e instanceof n)){var l=this._receiverAt(o);typeof t=="function"?t.call(l,m,e):l instanceof b&&!l._isResolved()&&l._promiseProgressed(m,e);continue}typeof t=="function"?d.invoke(this._doProgressWith,this,{handler:t,promise:e,receiver:this._receiverAt(o),value:m}):d.invoke(u,e,m)}}}},{"./async.js":2,"./util.js":38}],23:[function(r,y,A){y.exports=function(){var n=function(){return new u(`circular promise resolution chain

    See http://goo.gl/LhFpo0
`)},b=function(){return new i.PromiseInspection(this._target())},v=function(a){return i.reject(new u(a))},d=r("./util.js"),h;d.isNode?h=function(){var a=process.domain;return a===void 0&&(a=null),a}:h=function(){return null},d.notEnumerableProp(i,"_getDomain",h);var _={},m=r("./async.js"),f=r("./errors.js"),u=i.TypeError=f.TypeError;i.RangeError=f.RangeError,i.CancellationError=f.CancellationError,i.TimeoutError=f.TimeoutError,i.OperationalError=f.OperationalError,i.RejectionError=f.OperationalError,i.AggregateError=f.AggregateError;var o=function(){},t={},e={e:null},l=r("./thenables.js")(i,o),s=r("./promise_array.js")(i,o,l,v),w=r("./captured_trace.js")(),R=r("./debuggability.js")(i,w),g=r("./context.js")(i,w,R),j=r("./catch_filter.js")(e),k=r("./promise_resolver.js"),S=k._nodebackForPromise,D=d.errorObj,T=d.tryCatch;function i(a){if(typeof a!="function")throw new u(`the promise constructor requires a resolver function

    See http://goo.gl/EC22Yn
`);if(this.constructor!==i)throw new u(`the promise constructor cannot be invoked directly

    See http://goo.gl/KsIlge
`);this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._progressHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._settledValue=void 0,a!==o&&this._resolveFromResolver(a)}i.prototype.toString=function(){return"[object Promise]"},i.prototype.caught=i.prototype.catch=function(a){var c=arguments.length;if(c>1){var C=new Array(c-1),N=0,F;for(F=0;F<c-1;++F){var L=arguments[F];if(typeof L=="function")C[N++]=L;else return i.reject(new u(`Catch filter must inherit from Error or be a simple predicate function

    See http://goo.gl/o84o68
`))}C.length=N,a=arguments[F];var x=new j(C,a,this);return this._then(void 0,x.doFilter,void 0,x,void 0)}return this._then(void 0,a,void 0,void 0,void 0)},i.prototype.reflect=function(){return this._then(b,b,void 0,this,void 0)},i.prototype.then=function(a,c,C){if(R()&&arguments.length>0&&typeof a!="function"&&typeof c!="function"){var N=".then() only accepts functions but was passed: "+d.classString(a);arguments.length>1&&(N+=", "+d.classString(c)),this._warn(N)}return this._then(a,c,C,void 0,void 0)},i.prototype.done=function(a,c,C){var N=this._then(a,c,C,void 0,void 0);N._setIsFinal()},i.prototype.spread=function(a,c){return this.all()._then(a,c,void 0,t,void 0)},i.prototype.isCancellable=function(){return!this.isResolved()&&this._cancellable()},i.prototype.toJSON=function(){var a={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(a.fulfillmentValue=this.value(),a.isFulfilled=!0):this.isRejected()&&(a.rejectionReason=this.reason(),a.isRejected=!0),a},i.prototype.all=function(){return new s(this).promise()},i.prototype.error=function(a){return this.caught(d.originatesFromRejection,a)},i.getNewLibraryCopy=y.exports,i.is=function(a){return a instanceof i},i.fromNode=function(a){var c=new i(o),C=T(a)(S(c));return C===D&&c._rejectCallback(C.e,!0,!0),c},i.all=function(a){return new s(a).promise()},i.defer=i.pending=function(){var a=new i(o);return new k(a)},i.cast=function(a){var c=l(a);if(!(c instanceof i)){var C=c;c=new i(o),c._fulfillUnchecked(C)}return c},i.resolve=i.fulfilled=i.cast,i.reject=i.rejected=function(a){var c=new i(o);return c._captureStackTrace(),c._rejectCallback(a,!0),c},i.setScheduler=function(a){if(typeof a!="function")throw new u(`fn must be a function

    See http://goo.gl/916lJJ
`);var c=m._schedule;return m._schedule=a,c},i.prototype._then=function(a,c,C,N,F){var L=F!==void 0,x=L?F:new i(o);L||(x._propagateFrom(this,5),x._captureStackTrace());var I=this._target();I!==this&&(N===void 0&&(N=this._boundTo),L||x._setIsMigrated());var H=I._addCallbacks(a,c,C,x,N,h());return I._isResolved()&&!I._isSettlePromisesQueued()&&m.invoke(I._settlePromiseAtPostResolution,I,H),x},i.prototype._settlePromiseAtPostResolution=function(a){this._isRejectionUnhandled()&&this._unsetRejectionIsUnhandled(),this._settlePromiseAt(a)},i.prototype._length=function(){return this._bitField&131071},i.prototype._isFollowingOrFulfilledOrRejected=function(){return(this._bitField&939524096)>0},i.prototype._isFollowing=function(){return(this._bitField&536870912)===536870912},i.prototype._setLength=function(a){this._bitField=this._bitField&-131072|a&131071},i.prototype._setFulfilled=function(){this._bitField=this._bitField|268435456},i.prototype._setRejected=function(){this._bitField=this._bitField|134217728},i.prototype._setFollowing=function(){this._bitField=this._bitField|536870912},i.prototype._setIsFinal=function(){this._bitField=this._bitField|33554432},i.prototype._isFinal=function(){return(this._bitField&33554432)>0},i.prototype._cancellable=function(){return(this._bitField&67108864)>0},i.prototype._setCancellable=function(){this._bitField=this._bitField|67108864},i.prototype._unsetCancellable=function(){this._bitField=this._bitField&-67108865},i.prototype._setIsMigrated=function(){this._bitField=this._bitField|4194304},i.prototype._unsetIsMigrated=function(){this._bitField=this._bitField&-4194305},i.prototype._isMigrated=function(){return(this._bitField&4194304)>0},i.prototype._receiverAt=function(a){var c=a===0?this._receiver0:this[a*5-5+4];if(c!==_)return c===void 0&&this._isBound()?this._boundValue():c},i.prototype._promiseAt=function(a){return a===0?this._promise0:this[a*5-5+3]},i.prototype._fulfillmentHandlerAt=function(a){return a===0?this._fulfillmentHandler0:this[a*5-5+0]},i.prototype._rejectionHandlerAt=function(a){return a===0?this._rejectionHandler0:this[a*5-5+1]},i.prototype._boundValue=function(){var a=this._boundTo;return a!==void 0&&a instanceof i?a.isFulfilled()?a.value():void 0:a},i.prototype._migrateCallbacks=function(a,c){var C=a._fulfillmentHandlerAt(c),N=a._rejectionHandlerAt(c),F=a._progressHandlerAt(c),L=a._promiseAt(c),x=a._receiverAt(c);L instanceof i&&L._setIsMigrated(),x===void 0&&(x=_),this._addCallbacks(C,N,F,L,x,null)},i.prototype._addCallbacks=function(a,c,C,N,F,L){var x=this._length();if(x>=131066&&(x=0,this._setLength(0)),x===0)this._promise0=N,F!==void 0&&(this._receiver0=F),typeof a=="function"&&!this._isCarryingStackTrace()&&(this._fulfillmentHandler0=L===null?a:L.bind(a)),typeof c=="function"&&(this._rejectionHandler0=L===null?c:L.bind(c)),typeof C=="function"&&(this._progressHandler0=L===null?C:L.bind(C));else{var I=x*5-5;this[I+3]=N,this[I+4]=F,typeof a=="function"&&(this[I+0]=L===null?a:L.bind(a)),typeof c=="function"&&(this[I+1]=L===null?c:L.bind(c)),typeof C=="function"&&(this[I+2]=L===null?C:L.bind(C))}return this._setLength(x+1),x},i.prototype._setProxyHandlers=function(a,c){var C=this._length();if(C>=131066&&(C=0,this._setLength(0)),C===0)this._promise0=c,this._receiver0=a;else{var N=C*5-5;this[N+3]=c,this[N+4]=a}this._setLength(C+1)},i.prototype._proxyPromiseArray=function(a,c){this._setProxyHandlers(a,c)},i.prototype._resolveCallback=function(a,c){if(!this._isFollowingOrFulfilledOrRejected()){if(a===this)return this._rejectCallback(n(),!1,!0);var C=l(a,this);if(!(C instanceof i))return this._fulfill(a);var N=1|(c?4:0);this._propagateFrom(C,N);var F=C._target();if(F._isPending()){for(var L=this._length(),x=0;x<L;++x)F._migrateCallbacks(this,x);this._setFollowing(),this._setLength(0),this._setFollowee(F)}else F._isFulfilled()?this._fulfillUnchecked(F._value()):this._rejectUnchecked(F._reason(),F._getCarriedStackTrace())}},i.prototype._rejectCallback=function(a,c,C){C||d.markAsOriginatingFromRejection(a);var N=d.ensureErrorObject(a),F=N===a;this._attachExtraTrace(N,c?F:!1),this._reject(a,F?void 0:N)},i.prototype._resolveFromResolver=function(a){var c=this;this._captureStackTrace(),this._pushContext();var C=!0,N=T(a)(function(F){c!==null&&(c._resolveCallback(F),c=null)},function(F){c!==null&&(c._rejectCallback(F,C),c=null)});C=!1,this._popContext(),N!==void 0&&N===D&&c!==null&&(c._rejectCallback(N.e,!0,!0),c=null)},i.prototype._settlePromiseFromHandler=function(a,c,C,N){if(!N._isRejected()){N._pushContext();var F;if(c===t&&!this._isRejected()?F=T(a).apply(this._boundValue(),C):F=T(a).call(c,C),N._popContext(),F===D||F===N||F===e){var L=F===N?n():F.e;N._rejectCallback(L,!1,!0)}else N._resolveCallback(F)}},i.prototype._target=function(){for(var a=this;a._isFollowing();)a=a._followee();return a},i.prototype._followee=function(){return this._rejectionHandler0},i.prototype._setFollowee=function(a){this._rejectionHandler0=a},i.prototype._cleanValues=function(){this._cancellable()&&(this._cancellationParent=void 0)},i.prototype._propagateFrom=function(a,c){(c&1)>0&&a._cancellable()&&(this._setCancellable(),this._cancellationParent=a),(c&4)>0&&a._isBound()&&this._setBoundTo(a._boundTo)},i.prototype._fulfill=function(a){this._isFollowingOrFulfilledOrRejected()||this._fulfillUnchecked(a)},i.prototype._reject=function(a,c){this._isFollowingOrFulfilledOrRejected()||this._rejectUnchecked(a,c)},i.prototype._settlePromiseAt=function(a){var c=this._promiseAt(a),C=c instanceof i;if(C&&c._isMigrated())return c._unsetIsMigrated(),m.invoke(this._settlePromiseAt,this,a);var N=this._isFulfilled()?this._fulfillmentHandlerAt(a):this._rejectionHandlerAt(a),F=this._isCarryingStackTrace()?this._getCarriedStackTrace():void 0,L=this._settledValue,x=this._receiverAt(a);this._clearCallbackDataAtIndex(a),typeof N=="function"?C?this._settlePromiseFromHandler(N,x,L,c):N.call(x,L,c):x instanceof s?x._isResolved()||(this._isFulfilled()?x._promiseFulfilled(L,c):x._promiseRejected(L,c)):C&&(this._isFulfilled()?c._fulfill(L):c._reject(L,F)),a>=4&&(a&31)===4&&m.invokeLater(this._setLength,this,0)},i.prototype._clearCallbackDataAtIndex=function(a){if(a===0)this._isCarryingStackTrace()||(this._fulfillmentHandler0=void 0),this._rejectionHandler0=this._progressHandler0=this._receiver0=this._promise0=void 0;else{var c=a*5-5;this[c+3]=this[c+4]=this[c+0]=this[c+1]=this[c+2]=void 0}},i.prototype._isSettlePromisesQueued=function(){return(this._bitField&-1073741824)===-1073741824},i.prototype._setSettlePromisesQueued=function(){this._bitField=this._bitField|-1073741824},i.prototype._unsetSettlePromisesQueued=function(){this._bitField=this._bitField&1073741823},i.prototype._queueSettlePromises=function(){m.settlePromises(this),this._setSettlePromisesQueued()},i.prototype._fulfillUnchecked=function(a){if(a===this){var c=n();return this._attachExtraTrace(c),this._rejectUnchecked(c,void 0)}this._setFulfilled(),this._settledValue=a,this._cleanValues(),this._length()>0&&this._queueSettlePromises()},i.prototype._rejectUncheckedCheckError=function(a){var c=d.ensureErrorObject(a);this._rejectUnchecked(a,c===a?void 0:c)},i.prototype._rejectUnchecked=function(a,c){if(a===this){var C=n();return this._attachExtraTrace(C),this._rejectUnchecked(C)}if(this._setRejected(),this._settledValue=a,this._cleanValues(),this._isFinal()){m.throwLater(function(N){throw"stack"in N&&m.invokeFirst(w.unhandledRejection,void 0,N),N},c===void 0?a:c);return}c!==void 0&&c!==a&&this._setCarriedStackTrace(c),this._length()>0?this._queueSettlePromises():this._ensurePossibleRejectionHandled()},i.prototype._settlePromises=function(){this._unsetSettlePromisesQueued();for(var a=this._length(),c=0;c<a;c++)this._settlePromiseAt(c)},d.notEnumerableProp(i,"_makeSelfResolutionError",n),r("./progress.js")(i,s),r("./method.js")(i,o,l,v),r("./bind.js")(i,o,l),r("./finally.js")(i,e,l),r("./direct_resolve.js")(i),r("./synchronous_inspection.js")(i),r("./join.js")(i,s,l,o),i.version="2.11.0",i.Promise=i,r("./map.js")(i,s,v,l,o),r("./cancel.js")(i),r("./using.js")(i,v,l,g),r("./generators.js")(i,v,o,l),r("./nodeify.js")(i),r("./call_get.js")(i),r("./props.js")(i,s,l,v),r("./race.js")(i,o,l,v),r("./reduce.js")(i,s,v,l,o),r("./settle.js")(i,s),r("./some.js")(i,s,v),r("./promisify.js")(i,o),r("./any.js")(i),r("./each.js")(i,o),r("./timers.js")(i,o),r("./filter.js")(i,o),d.toFastProperties(i),d.toFastProperties(i.prototype);function P(a){var c=new i(o);c._fulfillmentHandler0=a,c._rejectionHandler0=a,c._progressHandler0=a,c._promise0=a,c._receiver0=a,c._settledValue=a}return P({a:1}),P({b:2}),P({c:3}),P(1),P(function(){}),P(void 0),P(!1),P(new i(o)),w.setBounds(m.firstLineError,d.lastLineError),i}},{"./any.js":1,"./async.js":2,"./bind.js":3,"./call_get.js":5,"./cancel.js":6,"./captured_trace.js":7,"./catch_filter.js":8,"./context.js":9,"./debuggability.js":10,"./direct_resolve.js":11,"./each.js":12,"./errors.js":13,"./filter.js":15,"./finally.js":16,"./generators.js":17,"./join.js":18,"./map.js":19,"./method.js":20,"./nodeify.js":21,"./progress.js":22,"./promise_array.js":24,"./promise_resolver.js":25,"./promisify.js":26,"./props.js":27,"./race.js":29,"./reduce.js":30,"./settle.js":32,"./some.js":33,"./synchronous_inspection.js":34,"./thenables.js":35,"./timers.js":36,"./using.js":37,"./util.js":38}],24:[function(r,y,A){y.exports=function(n,b,v,d){var h=r("./util.js"),_=h.isArray;function m(u){switch(u){case-2:return[];case-3:return{}}}function f(u){var o=this._promise=new n(b),t;u instanceof n&&(t=u,o._propagateFrom(t,5)),this._values=u,this._length=0,this._totalResolved=0,this._init(void 0,-2)}return f.prototype.length=function(){return this._length},f.prototype.promise=function(){return this._promise},f.prototype._init=function u(o,t){var e=v(this._values,this._promise);if(e instanceof n)if(e=e._target(),this._values=e,e._isFulfilled()){if(e=e._value(),!_(e)){var l=new n.TypeError(`expecting an array, a promise or a thenable

    See http://goo.gl/s8MMhc
`);this.__hardReject__(l);return}}else if(e._isPending()){e._then(u,this._reject,void 0,this,t);return}else{this._reject(e._reason());return}else if(!_(e)){this._promise._reject(d(`expecting an array, a promise or a thenable

    See http://goo.gl/s8MMhc
`)._reason());return}if(e.length===0){t===-5?this._resolveEmptyArray():this._resolve(m(t));return}var s=this.getActualLength(e.length);this._length=s,this._values=this.shouldCopyValues()?new Array(s):this._values;for(var w=this._promise,R=0;R<s;++R){var g=this._isResolved(),j=v(e[R],w);j instanceof n?(j=j._target(),g?j._ignoreRejections():j._isPending()?j._proxyPromiseArray(this,R):j._isFulfilled()?this._promiseFulfilled(j._value(),R):this._promiseRejected(j._reason(),R)):g||this._promiseFulfilled(j,R)}},f.prototype._isResolved=function(){return this._values===null},f.prototype._resolve=function(u){this._values=null,this._promise._fulfill(u)},f.prototype.__hardReject__=f.prototype._reject=function(u){this._values=null,this._promise._rejectCallback(u,!1,!0)},f.prototype._promiseProgressed=function(u,o){this._promise._progress({index:o,value:u})},f.prototype._promiseFulfilled=function(u,o){this._values[o]=u;var t=++this._totalResolved;t>=this._length&&this._resolve(this._values)},f.prototype._promiseRejected=function(u,o){this._totalResolved++,this._reject(u)},f.prototype.shouldCopyValues=function(){return!0},f.prototype.getActualLength=function(u){return u},f}},{"./util.js":38}],25:[function(r,y,A){var n=r("./util.js"),b=n.maybeWrapAsError,v=r("./errors.js"),d=v.TimeoutError,h=v.OperationalError,_=n.haveGetters,m=r("./es5.js");function f(s){return s instanceof Error&&m.getPrototypeOf(s)===Error.prototype}var u=/^(?:name|message|stack|cause)$/;function o(s){var w;if(f(s)){w=new h(s),w.name=s.name,w.message=s.message,w.stack=s.stack;for(var R=m.keys(s),g=0;g<R.length;++g){var j=R[g];u.test(j)||(w[j]=s[j])}return w}return n.markAsOriginatingFromRejection(s),s}function t(s){return function(w,R){if(s!==null){if(w){var g=o(b(w));s._attachExtraTrace(g),s._reject(g)}else if(arguments.length>2){for(var j=arguments.length,k=new Array(j-1),S=1;S<j;++S)k[S-1]=arguments[S];s._fulfill(k)}else s._fulfill(R);s=null}}}var e;if(_?e=function(s){this.promise=s}:e=function(s){this.promise=s,this.asCallback=t(s),this.callback=this.asCallback},_){var l={get:function(){return t(this.promise)}};m.defineProperty(e.prototype,"asCallback",l),m.defineProperty(e.prototype,"callback",l)}e._nodebackForPromise=t,e.prototype.toString=function(){return"[object PromiseResolver]"},e.prototype.resolve=e.prototype.fulfill=function(s){if(!(this instanceof e))throw new TypeError(`Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.

    See http://goo.gl/sdkXL9
`);this.promise._resolveCallback(s)},e.prototype.reject=function(s){if(!(this instanceof e))throw new TypeError(`Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.

    See http://goo.gl/sdkXL9
`);this.promise._rejectCallback(s)},e.prototype.progress=function(s){if(!(this instanceof e))throw new TypeError(`Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.

    See http://goo.gl/sdkXL9
`);this.promise._progress(s)},e.prototype.cancel=function(s){this.promise.cancel(s)},e.prototype.timeout=function(){this.reject(new d("timeout"))},e.prototype.isResolved=function(){return this.promise.isResolved()},e.prototype.toJSON=function(){return this.promise.toJSON()},y.exports=e},{"./errors.js":13,"./es5.js":14,"./util.js":38}],26:[function(r,y,A){y.exports=function(n,b){var v={},d=r("./util.js"),h=r("./promise_resolver.js")._nodebackForPromise,_=d.withAppended,m=d.maybeWrapAsError,f=d.canEvaluate,u=r("./errors").TypeError,o="Async",t={__isPromisified__:!0},e=["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"],l=new RegExp("^(?:"+e.join("|")+")$"),s=function(c){return d.isIdentifier(c)&&c.charAt(0)!=="_"&&c!=="constructor"};function w(c){return!l.test(c)}function R(c){try{return c.__isPromisified__===!0}catch{return!1}}function g(c,C,N){var F=d.getDataPropertyOrDefault(c,C+N,t);return F?R(F):!1}function j(c,C,N){for(var F=0;F<c.length;F+=2){var L=c[F];if(N.test(L)){for(var x=L.replace(N,""),I=0;I<c.length;I+=2)if(c[I]===x)throw new u(`Cannot promisify an API that has normal methods with '%s'-suffix

    See http://goo.gl/iWrZbw
`.replace("%s",C))}}}function k(c,C,N,F){for(var L=d.inheritedDataKeys(c),x=[],I=0;I<L.length;++I){var H=L[I],M=c[H],$=F===s?!0:s(H);typeof M=="function"&&!R(M)&&!g(c,H,C)&&F(H,M,c,$)&&x.push(H,M)}return j(x,C,N),x}var S=function(c){return c.replace(/([$])/,"\\$")},D;function T(c,C,N,F){var L=(function(){return this})(),x=c;typeof x=="string"&&(c=F);function I(){var H=C;C===v&&(H=this);var M=new n(b);M._captureStackTrace();var $=typeof x=="string"&&this!==L?this[x]:c,q=h(M);try{$.apply(H,_(arguments,q))}catch(z){M._rejectCallback(m(z),!0,!0)}return M}return d.notEnumerableProp(I,"__isPromisified__",!0),I}var i=f?D:T;function P(c,C,N,F){for(var L=new RegExp(S(C)+"$"),x=k(c,C,L,N),I=0,H=x.length;I<H;I+=2){var M=x[I],$=x[I+1],q=M+C;if(F===i)c[q]=i(M,v,M,$,C);else{var z=F($,function(){return i(M,v,M,$,C)});d.notEnumerableProp(z,"__isPromisified__",!0),c[q]=z}}return d.toFastProperties(c),c}function a(c,C){return i(c,C,void 0,c)}n.promisify=function(c,C){if(typeof c!="function")throw new u(`fn must be a function

    See http://goo.gl/916lJJ
`);if(R(c))return c;var N=a(c,arguments.length<2?v:C);return d.copyDescriptors(c,N,w),N},n.promisifyAll=function(c,C){if(typeof c!="function"&&typeof c!="object")throw new u(`the target of promisifyAll must be an object or a function

    See http://goo.gl/9ITlV0
`);C=Object(C);var N=C.suffix;typeof N!="string"&&(N=o);var F=C.filter;typeof F!="function"&&(F=s);var L=C.promisifier;if(typeof L!="function"&&(L=i),!d.isIdentifier(N))throw new RangeError(`suffix must be a valid identifier

    See http://goo.gl/8FZo5V
`);for(var x=d.inheritedDataKeys(c),I=0;I<x.length;++I){var H=c[x[I]];x[I]!=="constructor"&&d.isClass(H)&&(P(H.prototype,N,F,L),P(H,N,F,L))}return P(c,N,F,L)}}},{"./errors":13,"./promise_resolver.js":25,"./util.js":38}],27:[function(r,y,A){y.exports=function(n,b,v,d){var h=r("./util.js"),_=h.isObject,m=r("./es5.js");function f(o){for(var t=m.keys(o),e=t.length,l=new Array(e*2),s=0;s<e;++s){var w=t[s];l[s]=o[w],l[s+e]=w}this.constructor$(l)}h.inherits(f,b),f.prototype._init=function(){this._init$(void 0,-3)},f.prototype._promiseFulfilled=function(o,t){this._values[t]=o;var e=++this._totalResolved;if(e>=this._length){for(var l={},s=this.length(),w=0,R=this.length();w<R;++w)l[this._values[w+s]]=this._values[w];this._resolve(l)}},f.prototype._promiseProgressed=function(o,t){this._promise._progress({key:this._values[t+this.length()],value:o})},f.prototype.shouldCopyValues=function(){return!1},f.prototype.getActualLength=function(o){return o>>1};function u(o){var t,e=v(o);if(_(e))e instanceof n?t=e._then(n.props,void 0,void 0,void 0,void 0):t=new f(e).promise();else return d(`cannot await properties of a non-object

    See http://goo.gl/OsFKC8
`);return e instanceof n&&t._propagateFrom(e,4),t}n.prototype.props=function(){return u(this)},n.props=function(o){return u(o)}}},{"./es5.js":14,"./util.js":38}],28:[function(r,y,A){function n(v,d,h,_,m){for(var f=0;f<m;++f)h[f+_]=v[f+d],v[f+d]=void 0}function b(v){this._capacity=v,this._length=0,this._front=0}b.prototype._willBeOverCapacity=function(v){return this._capacity<v},b.prototype._pushOne=function(v){var d=this.length();this._checkCapacity(d+1);var h=this._front+d&this._capacity-1;this[h]=v,this._length=d+1},b.prototype._unshiftOne=function(v){var d=this._capacity;this._checkCapacity(this.length()+1);var h=this._front,_=(h-1&d-1^d)-d;this[_]=v,this._front=_,this._length=this.length()+1},b.prototype.unshift=function(v,d,h){this._unshiftOne(h),this._unshiftOne(d),this._unshiftOne(v)},b.prototype.push=function(v,d,h){var _=this.length()+3;if(this._willBeOverCapacity(_)){this._pushOne(v),this._pushOne(d),this._pushOne(h);return}var m=this._front+_-3;this._checkCapacity(_);var f=this._capacity-1;this[m+0&f]=v,this[m+1&f]=d,this[m+2&f]=h,this._length=_},b.prototype.shift=function(){var v=this._front,d=this[v];return this[v]=void 0,this._front=v+1&this._capacity-1,this._length--,d},b.prototype.length=function(){return this._length},b.prototype._checkCapacity=function(v){this._capacity<v&&this._resizeTo(this._capacity<<1)},b.prototype._resizeTo=function(v){var d=this._capacity;this._capacity=v;var h=this._front,_=this._length,m=h+_&d-1;n(this,0,this,d,m)},y.exports=b},{}],29:[function(r,y,A){y.exports=function(n,b,v,d){var h=r("./util.js").isArray,_=function(f){return f.then(function(u){return m(u,f)})};function m(f,u){var o=v(f);if(o instanceof n)return _(o);if(!h(f))return d(`expecting an array, a promise or a thenable

    See http://goo.gl/s8MMhc
`);var t=new n(b);u!==void 0&&t._propagateFrom(u,5);for(var e=t._fulfill,l=t._reject,s=0,w=f.length;s<w;++s){var R=f[s];R===void 0&&!(s in f)||n.cast(R)._then(e,l,void 0,t,null)}return t}n.race=function(f){return m(f,void 0)},n.prototype.race=function(){return m(this,void 0)}}},{"./util.js":38}],30:[function(r,y,A){y.exports=function(n,b,v,d,h){var _=n._getDomain,m=r("./async.js"),f=r("./util.js"),u=f.tryCatch,o=f.errorObj;function t(s,w,R,g){this.constructor$(s),this._promise._captureStackTrace(),this._preservedValues=g===h?[]:null,this._zerothIsAccum=R===void 0,this._gotAccum=!1,this._reducingIndex=this._zerothIsAccum?1:0,this._valuesPhase=void 0;var j=d(R,this._promise),k=!1,S=j instanceof n;S&&(j=j._target(),j._isPending()?j._proxyPromiseArray(this,-1):j._isFulfilled()?(R=j._value(),this._gotAccum=!0):(this._reject(j._reason()),k=!0)),S||this._zerothIsAccum||(this._gotAccum=!0);var D=_();this._callback=D===null?w:D.bind(w),this._accum=R,k||m.invoke(e,this,void 0)}function e(){this._init$(void 0,-5)}f.inherits(t,b),t.prototype._init=function(){},t.prototype._resolveEmptyArray=function(){(this._gotAccum||this._zerothIsAccum)&&this._resolve(this._preservedValues!==null?[]:this._accum)},t.prototype._promiseFulfilled=function(s,w){var R=this._values;R[w]=s;var g=this.length(),j=this._preservedValues,k=j!==null,S=this._gotAccum,D=this._valuesPhase,T;if(!D)for(D=this._valuesPhase=new Array(g),T=0;T<g;++T)D[T]=0;if(T=D[w],w===0&&this._zerothIsAccum?(this._accum=s,this._gotAccum=S=!0,D[w]=T===0?1:2):w===-1?(this._accum=s,this._gotAccum=S=!0):T===0?D[w]=1:(D[w]=2,this._accum=s),!!S){for(var i=this._callback,P=this._promise._boundValue(),a,c=this._reducingIndex;c<g;++c){if(T=D[c],T===2){this._reducingIndex=c+1;continue}if(T!==1)return;if(s=R[c],this._promise._pushContext(),k?(j.push(s),a=u(i).call(P,s,c,g)):a=u(i).call(P,this._accum,s,c,g),this._promise._popContext(),a===o)return this._reject(a.e);var C=d(a,this._promise);if(C instanceof n){if(C=C._target(),C._isPending())return D[c]=4,C._proxyPromiseArray(this,c);if(C._isFulfilled())a=C._value();else return this._reject(C._reason())}this._reducingIndex=c+1,this._accum=a}this._resolve(k?j:this._accum)}};function l(s,w,R,g){if(typeof w!="function")return v(`fn must be a function

    See http://goo.gl/916lJJ
`);var j=new t(s,w,R,g);return j.promise()}n.prototype.reduce=function(s,w){return l(this,s,w,null)},n.reduce=function(s,w,R,g){return l(s,w,R,g)}}},{"./async.js":2,"./util.js":38}],31:[function(r,y,A){var n,b=r("./util"),v=function(){throw new Error(`No async scheduler available

    See http://goo.gl/m3OTXk
`)};if(b.isNode&&typeof MutationObserver>"u"){var d=pt.setImmediate,h=process.nextTick;n=b.isRecentNode?function(_){d.call(pt,_)}:function(_){h.call(process,_)}}else typeof MutationObserver<"u"&&!(typeof window<"u"&&window.navigator&&window.navigator.standalone)?(n=function(_){var m=document.createElement("div"),f=new MutationObserver(_);return f.observe(m,{attributes:!0}),function(){m.classList.toggle("foo")}},n.isStatic=!0):typeof setImmediate<"u"?n=function(_){setImmediate(_)}:typeof setTimeout<"u"?n=function(_){setTimeout(_,0)}:n=v;y.exports=n},{"./util":38}],32:[function(r,y,A){y.exports=function(n,b){var v=n.PromiseInspection,d=r("./util.js");function h(_){this.constructor$(_)}d.inherits(h,b),h.prototype._promiseResolved=function(_,m){this._values[_]=m;var f=++this._totalResolved;f>=this._length&&this._resolve(this._values)},h.prototype._promiseFulfilled=function(_,m){var f=new v;f._bitField=268435456,f._settledValue=_,this._promiseResolved(m,f)},h.prototype._promiseRejected=function(_,m){var f=new v;f._bitField=134217728,f._settledValue=_,this._promiseResolved(m,f)},n.settle=function(_){return new h(_).promise()},n.prototype.settle=function(){return new h(this).promise()}}},{"./util.js":38}],33:[function(r,y,A){y.exports=function(n,b,v){var d=r("./util.js"),h=r("./errors.js").RangeError,_=r("./errors.js").AggregateError,m=d.isArray;function f(o){this.constructor$(o),this._howMany=0,this._unwrap=!1,this._initialized=!1}d.inherits(f,b),f.prototype._init=function(){if(this._initialized){if(this._howMany===0){this._resolve([]);return}this._init$(void 0,-5);var o=m(this._values);!this._isResolved()&&o&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},f.prototype.init=function(){this._initialized=!0,this._init()},f.prototype.setUnwrap=function(){this._unwrap=!0},f.prototype.howMany=function(){return this._howMany},f.prototype.setHowMany=function(o){this._howMany=o},f.prototype._promiseFulfilled=function(o){this._addFulfilled(o),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),this.howMany()===1&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values))},f.prototype._promiseRejected=function(o){if(this._addRejected(o),this.howMany()>this._canPossiblyFulfill()){for(var t=new _,e=this.length();e<this._values.length;++e)t.push(this._values[e]);this._reject(t)}},f.prototype._fulfilled=function(){return this._totalResolved},f.prototype._rejected=function(){return this._values.length-this.length()},f.prototype._addRejected=function(o){this._values.push(o)},f.prototype._addFulfilled=function(o){this._values[this._totalResolved++]=o},f.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},f.prototype._getRangeError=function(o){var t="Input array must contain at least "+this._howMany+" items but contains only "+o+" items";return new h(t)},f.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))};function u(o,t){if((t|0)!==t||t<0)return v(`expecting a positive integer

    See http://goo.gl/1wAmHx
`);var e=new f(o),l=e.promise();return e.setHowMany(t),e.init(),l}n.some=function(o,t){return u(o,t)},n.prototype.some=function(o){return u(this,o)},n._SomePromiseArray=f}},{"./errors.js":13,"./util.js":38}],34:[function(r,y,A){y.exports=function(n){function b(v){v!==void 0?(v=v._target(),this._bitField=v._bitField,this._settledValue=v._settledValue):(this._bitField=0,this._settledValue=void 0)}b.prototype.value=function(){if(!this.isFulfilled())throw new TypeError(`cannot get fulfillment value of a non-fulfilled promise

    See http://goo.gl/hc1DLj
`);return this._settledValue},b.prototype.error=b.prototype.reason=function(){if(!this.isRejected())throw new TypeError(`cannot get rejection reason of a non-rejected promise

    See http://goo.gl/hPuiwB
`);return this._settledValue},b.prototype.isFulfilled=n.prototype._isFulfilled=function(){return(this._bitField&268435456)>0},b.prototype.isRejected=n.prototype._isRejected=function(){return(this._bitField&134217728)>0},b.prototype.isPending=n.prototype._isPending=function(){return(this._bitField&402653184)===0},b.prototype.isResolved=n.prototype._isResolved=function(){return(this._bitField&402653184)>0},n.prototype.isPending=function(){return this._target()._isPending()},n.prototype.isRejected=function(){return this._target()._isRejected()},n.prototype.isFulfilled=function(){return this._target()._isFulfilled()},n.prototype.isResolved=function(){return this._target()._isResolved()},n.prototype._value=function(){return this._settledValue},n.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue},n.prototype.value=function(){var v=this._target();if(!v.isFulfilled())throw new TypeError(`cannot get fulfillment value of a non-fulfilled promise

    See http://goo.gl/hc1DLj
`);return v._settledValue},n.prototype.reason=function(){var v=this._target();if(!v.isRejected())throw new TypeError(`cannot get rejection reason of a non-rejected promise

    See http://goo.gl/hPuiwB
`);return v._unsetRejectionIsUnhandled(),v._settledValue},n.PromiseInspection=b}},{}],35:[function(r,y,A){y.exports=function(n,b){var v=r("./util.js"),d=v.errorObj,h=v.isObject;function _(t,e){if(h(t)){if(t instanceof n)return t;if(u(t)){var l=new n(b);return t._then(l._fulfillUnchecked,l._rejectUncheckedCheckError,l._progressUnchecked,l,null),l}var s=v.tryCatch(m)(t);if(s===d){e&&e._pushContext();var l=n.reject(s.e);return e&&e._popContext(),l}else if(typeof s=="function")return o(t,s,e)}return t}function m(t){return t.then}var f={}.hasOwnProperty;function u(t){return f.call(t,"_promise0")}function o(t,e,l){var s=new n(b),w=s;l&&l._pushContext(),s._captureStackTrace(),l&&l._popContext();var R=!0,g=v.tryCatch(e).call(t,j,k,S);R=!1,s&&g===d&&(s._rejectCallback(g.e,!0,!0),s=null);function j(D){s&&(s._resolveCallback(D),s=null)}function k(D){s&&(s._rejectCallback(D,R,!0),s=null)}function S(D){s&&typeof s._progress=="function"&&s._progress(D)}return w}return _}},{"./util.js":38}],36:[function(r,y,A){y.exports=function(n,b){var v=r("./util.js"),d=n.TimeoutError,h=function(o,t){if(o.isPending()){var e;!v.isPrimitive(t)&&t instanceof Error?e=t:(typeof t!="string"&&(t="operation timed out"),e=new d(t)),v.markAsOriginatingFromRejection(e),o._attachExtraTrace(e),o._cancel(e)}},_=function(o){return m(+this).thenReturn(o)},m=n.delay=function(o,t){if(t===void 0){t=o,o=void 0;var e=new n(b);return setTimeout(function(){e._fulfill()},t),e}return t=+t,n.resolve(o)._then(_,null,null,t,void 0)};n.prototype.delay=function(o){return m(this,o)};function f(o){var t=this;return t instanceof Number&&(t=+t),clearTimeout(t),o}function u(o){var t=this;throw t instanceof Number&&(t=+t),clearTimeout(t),o}n.prototype.timeout=function(o,t){o=+o;var e=this.then().cancellable();e._cancellationParent=this;var l=setTimeout(function(){h(e,t)},o);return e._then(f,u,void 0,l,void 0)}}},{"./util.js":38}],37:[function(r,y,A){y.exports=function(n,b,v,d){var h=r("./errors.js").TypeError,_=r("./util.js").inherits,m=n.PromiseInspection;function f(g){for(var j=g.length,k=0;k<j;++k){var S=g[k];if(S.isRejected())return n.reject(S.error());g[k]=S._settledValue}return g}function u(g){setTimeout(function(){throw g},0)}function o(g){var j=v(g);return j!==g&&typeof g._isDisposable=="function"&&typeof g._getDisposer=="function"&&g._isDisposable()&&j._setDisposable(g._getDisposer()),j}function t(g,j){var k=0,S=g.length,D=n.defer();function T(){if(k>=S)return D.resolve();var i=o(g[k++]);if(i instanceof n&&i._isDisposable()){try{i=v(i._getDisposer().tryDispose(j),g.promise)}catch(P){return u(P)}if(i instanceof n)return i._then(T,u,null,null,null)}T()}return T(),D.promise}function e(g){var j=new m;return j._settledValue=g,j._bitField=268435456,t(this,j).thenReturn(g)}function l(g){var j=new m;return j._settledValue=g,j._bitField=134217728,t(this,j).thenThrow(g)}function s(g,j,k){this._data=g,this._promise=j,this._context=k}s.prototype.data=function(){return this._data},s.prototype.promise=function(){return this._promise},s.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():null},s.prototype.tryDispose=function(g){var j=this.resource(),k=this._context;k!==void 0&&k._pushContext();var S=j!==null?this.doDispose(j,g):null;return k!==void 0&&k._popContext(),this._promise._unsetDisposable(),this._data=null,S},s.isDisposer=function(g){return g!=null&&typeof g.resource=="function"&&typeof g.tryDispose=="function"};function w(g,j,k){this.constructor$(g,j,k)}_(w,s),w.prototype.doDispose=function(g,j){var k=this.data();return k.call(g,g,j)};function R(g){return s.isDisposer(g)?(this.resources[this.index]._setDisposable(g),g.promise()):g}n.using=function(){var g=arguments.length;if(g<2)return b("you must pass at least 2 arguments to Promise.using");var j=arguments[g-1];if(typeof j!="function")return b(`fn must be a function

    See http://goo.gl/916lJJ
`);var k,S=!0;g===2&&Array.isArray(arguments[0])?(k=arguments[0],g=k.length,S=!1):(k=arguments,g--);for(var D=new Array(g),T=0;T<g;++T){var i=k[T];if(s.isDisposer(i)){var P=i;i=i.promise(),i._setDisposable(P)}else{var a=v(i);a instanceof n&&(i=a._then(R,null,null,{resources:D,index:T},void 0))}D[T]=i}var c=n.settle(D).then(f).then(function(C){c._pushContext();var N;try{N=S?j.apply(void 0,C):j.call(void 0,C)}finally{c._popContext()}return N})._then(e,l,void 0,D,void 0);return D.promise=c,c},n.prototype._setDisposable=function(g){this._bitField=this._bitField|262144,this._disposer=g},n.prototype._isDisposable=function(){return(this._bitField&262144)>0},n.prototype._getDisposer=function(){return this._disposer},n.prototype._unsetDisposable=function(){this._bitField=this._bitField&-262145,this._disposer=void 0},n.prototype.disposer=function(g){if(typeof g=="function")return new w(g,this,d());throw new h}}},{"./errors.js":13,"./util.js":38}],38:[function(r,y,A){var n=r("./es5.js"),b=typeof navigator>"u",v=(function(){try{var x={};return n.defineProperty(x,"f",{get:function(){return 3}}),x.f===3}catch{return!1}})(),d={e:{}},h;function _(){try{var x=h;return h=null,x.apply(this,arguments)}catch(I){return d.e=I,d}}function m(x){return h=x,_}var f=function(x,I){var H={}.hasOwnProperty;function M(){this.constructor=x,this.constructor$=I;for(var $ in I.prototype)H.call(I.prototype,$)&&$.charAt($.length-1)!=="$"&&(this[$+"$"]=I.prototype[$])}return M.prototype=I.prototype,x.prototype=new M,x.prototype};function u(x){return x==null||x===!0||x===!1||typeof x=="string"||typeof x=="number"}function o(x){return!u(x)}function t(x){return u(x)?new Error(i(x)):x}function e(x,I){var H=x.length,M=new Array(H+1),$;for($=0;$<H;++$)M[$]=x[$];return M[$]=I,M}function l(x,I,H){if(n.isES5){var M=Object.getOwnPropertyDescriptor(x,I);if(M!=null)return M.get==null&&M.set==null?M.value:H}else return{}.hasOwnProperty.call(x,I)?x[I]:void 0}function s(x,I,H){if(u(x))return x;var M={value:H,configurable:!0,enumerable:!1,writable:!0};return n.defineProperty(x,I,M),x}function w(x){throw x}var R=(function(){var x=[Array.prototype,Object.prototype,Function.prototype],I=function($){for(var q=0;q<x.length;++q)if(x[q]===$)return!0;return!1};if(n.isES5){var H=Object.getOwnPropertyNames;return function($){for(var q=[],z=Object.create(null);$!=null&&!I($);){var J;try{J=H($)}catch{return q}for(var W=0;W<J.length;++W){var G=J[W];if(!z[G]){z[G]=!0;var Z=Object.getOwnPropertyDescriptor($,G);Z!=null&&Z.get==null&&Z.set==null&&q.push(G)}}$=n.getPrototypeOf($)}return q}}else{var M={}.hasOwnProperty;return function($){if(I($))return[];var q=[];t:for(var z in $)if(M.call($,z))q.push(z);else{for(var J=0;J<x.length;++J)if(M.call(x[J],z))continue t;q.push(z)}return q}}})(),g=/this\s*\.\s*\S+\s*=/;function j(x){try{if(typeof x=="function"){var I=n.names(x.prototype),H=n.isES5&&I.length>1,M=I.length>0&&!(I.length===1&&I[0]==="constructor"),$=g.test(x+"")&&n.names(x).length>0;if(H||M||$)return!0}return!1}catch{return!1}}function k(x){return x}var S=/^[a-z$_][a-z$_0-9]*$/i;function D(x){return S.test(x)}function T(x,I,H){for(var M=new Array(x),$=0;$<x;++$)M[$]=I+$+H;return M}function i(x){try{return x+""}catch{return"[no string representation]"}}function P(x){try{s(x,"isOperational",!0)}catch{}}function a(x){return x==null?!1:x instanceof Error.__BluebirdErrorTypes__.OperationalError||x.isOperational===!0}function c(x){return x instanceof Error&&n.propertyIsWritable(x,"stack")}var C=(function(){return"stack"in new Error?function(x){return c(x)?x:new Error(i(x))}:function(x){if(c(x))return x;try{throw new Error(i(x))}catch(I){return I}}})();function N(x){return{}.toString.call(x)}function F(x,I,H){for(var M=n.names(x),$=0;$<M.length;++$){var q=M[$];if(H(q))try{n.defineProperty(I,q,n.getDescriptor(x,q))}catch{}}}var L={isClass:j,isIdentifier:D,inheritedDataKeys:R,getDataPropertyOrDefault:l,thrower:w,isArray:n.isArray,haveGetters:v,notEnumerableProp:s,isPrimitive:u,isObject:o,canEvaluate:b,errorObj:d,tryCatch:m,inherits:f,withAppended:e,maybeWrapAsError:t,toFastProperties:k,filledRange:T,toString:i,canAttachTrace:c,ensureErrorObject:C,originatesFromRejection:a,markAsOriginatingFromRejection:P,classString:N,copyDescriptors:F,hasDevTools:typeof chrome<"u"&&chrome&&typeof chrome.loadTimes=="function",isNode:typeof process<"u"&&N(process).toLowerCase()==="[object process]"};L.isRecentNode=L.isNode&&(function(){var x=process.versions.node.split(".").map(Number);return x[0]===0&&x[1]>10||x[0]>0})(),L.isNode&&L.toFastProperties(process);try{throw new Error}catch(x){L.lastLineError=x}y.exports=L},{"./es5.js":14}]},{},[4])(4)}),typeof window<"u"&&window!==null?window.P=window.Promise:typeof self<"u"&&self!==null&&(self.P=self.Promise)})(it)),it.exports}var st,gt;function Tt(){if(gt)return st;gt=1;var U=Rt(),O=ct(),E=ut();r.prototype=Object.create(U.prototype),r.prototype.constructor=r;function r(y,A){U.call(this,y,A),this.baseURL=this.baseURL+"/checkout-invoice"}return r.prototype.create=function(){var y=this,A=y.generateRequestBody();return new E(function(n,b){O.post(y.baseURL+"/create").set(y.config).send(A).end(function(v,d){if(v)return b(v);if(d.body.response_code==="00")y.token=d.body.token,y.url=d.body.response_text,n(y.confirm());else{var h=new Error("Failed to create invoice.");h.data=d.body,b(h)}})})},r.prototype.confirm=function(y){var A=this,n=y||A.token;return new E(function(b,v){O.get(A.baseURL+"/confirm/"+n).set(A.config).end(function(d,h){if(d)return v(d);var _=h.body;if(_.response_code==="00")A.status=_.status,A.responseText=_.response_text,A.status==="completed"&&(A.customer=_.customer,A.receiptURL=_.receipt_url,A.receipt_identifier=_.receipt_identifier,A.provider_reference=_.provider_reference,_.custom_data&&Object.keys(_.custom_data).length>0&&(A.customData=_.custom_data)),A.totalAmount=_.invoice.total_amount,b();else{var m=new Error("Could not confirm invoice status.");m.data=_,v(m)}})})},st=r,st}var ot,xt;function qt(){if(xt)return ot;xt=1;var U=Rt(),O=ct(),E=ut();r.prototype=Object.create(U.prototype),r.prototype.constructor=r;function r(y,A){U.call(this,y,A),this.baseURL=this.baseURL+"/opr"}return r.prototype.create=function(y){var A=this,n={invoice_data:A.generateRequestBody(),opr_data:{account_alias:String(y)}};return new E(function(b,v){O.post(A.baseURL+"/create").set(A.config).send(n).end(function(d,h){if(d)return v(d);if(h.body.response_code==="00")A.token=h.body.invoice_token,A.oprToken=h.body.token,A.responseText=h.body.description,b();else{var _=new Error("Failed to create invoice");_.data=h.body,v(_)}})})},r.prototype.charge=function(y,A){var n=this,b={token:y+"",confirm_token:A+""};return new E(function(v,d){O.post(n.baseURL+"/charge").set(n.config).send(b).end(function(h,_){if(h)return d(h);if(_.body.response_code==="00")n.responseText=_.body.response_text,n.status=_.body.invoice_data.status,n.receiptURL=_.body.invoice_data.receipt_url,n.customer=_.body.invoice_data.customer,v();else{var m=new Error("Failed to charge invoice. Check OPR/confirm token and try again.");m.data=_.body,d(m)}})})},ot=r,ot}const Bt={},zt=Object.freeze(Object.defineProperty({__proto__:null,default:Bt},Symbol.toStringTag,{value:"Module"})),Qt=Ut(zt);var at,bt;function Yt(){if(bt)return at;bt=1;var U=ct(),O=ut(),E=Qt;function r(y){if(!(y&&y.config))throw new Error("Must be initialized with instance of paydunya.Setup");this.config=y.config,this.baseURL=y.baseURL+"/direct-pay"}return r.prototype.creditAccount=function(y,A){var n=this,b={account_alias:y,amount:Number(A)};return new O(function(v,d){U.post(n.baseURL+"/credit-account").set(n.config).send(b).end(function(h,_){if(h)return d(h);if(_.body.response_code==="00")n.responseText=_.body.response_text,n.description=_.body.description,n.transactionID=_.body.transaction_id,v();else{var m=new Error(new Error(E.format("Failed to credit account. Please ensure %s and %s are valid OR check your account balance.",y,A)));m.data=_.body,d(m)}})})},at=r,at}var jt;function Jt(){if(jt)return Q;jt=1;var U={};Q.Setup=Q.setup=O,Q.Store=Q.store=E,Q.CheckoutInvoice=Q.checkoutInvoice=Tt(),Q.OnsiteInvoice=Q.onsiteInvoice=qt(),Q.DirectPay=Q.directPay=Yt();function O(r){this.config={},this.config["PAYDUNYA-MASTER-KEY"]=r&&r.masterKey||U.PAYDUNYA_MASTER_KEY,this.config["PAYDUNYA-PRIVATE-KEY"]=r&&r.privateKey||U.PAYDUNYA_PRIVATE_KEY,this.config["PAYDUNYA-TOKEN"]=r&&r.token||U.PAYDUNYA_TOKEN,this.config["Content-Type"]="application/json",r&&r.mode&&r.mode.toLowerCase()==="test"?this.baseURL="https://app.paydunya.com/sandbox-api/v1":this.baseURL="https://app.paydunya.com/api/v1"}function E(r){if(!(r&&r.name))throw new Error("Invalid parameters.");this.name=r.name,r.tagline&&(this.tagline=r.tagline),r.phoneNumber&&(this.phone_number=r.phoneNumber),r.postalAddress&&(this.postal_address=r.postalAddress),r.logoURL&&(this.logo_url=r.logoURL),r.websiteURL&&(this.website_url=r.websiteURL),r.cancelURL&&(this.cancel_url=r.cancelURL),r.returnURL&&(this.return_url=r.returnURL),r.callbackURL&&(this.callback_url=r.callbackURL)}return Q}var Kt=Jt();const wt=Ct(Kt);var Gt=Tt();const Xt=Ct(Gt),Wt=({handlePay:U,totalAmount:O,onClose:E,order:r,idOrder:y})=>{console.log(r),localStorage.setItem("idOrderPayment",null),localStorage.setItem("montant",null),localStorage.setItem("tokenOrderPayment",null),localStorage.setItem("statusOrderPayment",null);const A=Ft(),{payment:n,setUserPayment:b,setOrder:v,setPaymentDetails:d,setTotalAmount:h}=B.useContext(St),{user:_}=kt(),[m,f]=B.useState(!1),[u,o]=B.useState(!0),[t,e]=B.useState(null),[l,s]=B.useState(null),[w,R]=B.useState(null);B.useEffect(()=>{b(_),v(r),console.log("order "+y),console.log("motant "+O),console.log("user"),console.log(_);const k=new wt.Setup({masterKey:"voFGVcul-uCsd-1sw5-wfGz-ukqScIQoOyDu",privateKey:"live_private_KvbXuQU1IJ4z68hQOU9YeEtrUjW",publicKey:"live_public_wgK4JebXd3SfGDWN64sEIffD5XR",token:"cjTGi71WL8xOTCrsJisR",mode:"live"});e(k);const S=new wt.Store({name:"CCBM SHOP",email:"shop@ccbm.sn",tagline:"Votre boutique pour vos matériels électroménéger",phoneNumber:"+221 70 922 17 75",postalAddress:"Avenue Lamine Gueye,x Rue Marchand,Dakar-Senegal",logoURL:"https://www.ccbmshop.sn/logo_192.png",websiteURL:"https://www.ccbmshop.sn/"});s(S)},[]);const g=k=>{if(console.log("arrivé"),f(!0),k.preventDefault(),t&&l&&O>0){const S=new Xt(t,l);console.log(S),r.order_lines.forEach(D=>{S.addItem(D.product_name,D.product_uom_qty,D.price_unit,D.price_subtotal)}),console.log(S),S.totalAmount=Math.ceil(O),r.type_sale==="order"?r.payment_mode=="echelonne"?S.description=`Paiement d'avance de ${V(Math.ceil(O))} pour la commande ${r.name}`:r.payment_mode=="online"&&(S.description=`Paiement de ${V(Math.ceil(O))} pour la commande ${r.name}`):r.type_sale==="preorder"?r.amount_residual>0?S.description=`Paiement de ${V(Math.ceil(O))} pour la précommande ${r.name} avec un montant total restant de ${r.amount_total-O}`:S.description=`Paiement de ${V(Math.ceil(O))} pour la précommande ${r.name}`:r.type_sale==="creditorder"&&(r.amount_residual>0?S.description=`Paiement de ${V(Math.ceil(O))} pour le crédit ${r.name} avec un montant total restant de ${r.amount_total-O}`:S.description=`Paiement de ${V(Math.ceil(O))} pour le crédit ${r.name}`),S.callbackURL="https://orbitcity.odoo.com/api/facture/paydunya",r.type_sale==="order"?S.returnURL=`http://localhost:5173/commandes/${y}/détails`:r.type_sale==="creditorder"?S.returnURL=`http://localhost:5173/credit-commandes/${y}/détails`:r.type_sale==="preorder"&&(S.returnURL=`http://localhost:5173/pre-commandes/${y}/détails`),S.returnURL="http://localhost:5173/payment-state",console.log("invoice",S),console.log(r),d(S),h(S.totalAmount),console.log(S),S.create().then(async function(){R(S),console.log(S),At(y,O,r.order_lines.map(i=>({name:i.product_name,price:i.price_unit,quantity:i.product_uom_qty})));let D=null;r.type_sale==="order"?r.payment_mode=="echelonne"?D=`${_.id}-${y}-${O}-${r.name}-${r.type_sale}-${new Date().getTime().toString()}`:D=`${_.id}-${y}-${O}-${r.name}-${r.type_sale}`:r.type_sale==="preorder"?!r.first_payment_state&&!r.second_payment_state&&!r.third_payment_state?D=`${_.id}-${y}-${O}-${r.name}-${r.type_sale}-1`:r.first_payment_state&&!r.second_payment_state&&!r.third_payment_state?D=`${_.id}-${y}-${O}-${r.name}-${r.type_sale}-2`:D=`${_.id}-${y}-${O}-${r.name}-${r.type_sale}-3`:r.type_sale==="creditorder"?!r.first_payment_state&&!r.second_payment_state&&!r.third_payment_state&&!r.fourth_payment_state?D=`${_.id}-${y}-${O}-${r.name}-${r.type_sale}-1`:r.first_payment_state&&!r.second_payment_state&&!r.third_payment_state&&!r.fourth_payment_state?D=`${_.id}-${y}-${O}-${r.name}-${r.type_sale}-2`:r.first_payment_state&&r.second_payment_state&&r.third_payment_state&&!r.fourth_payment_state?D=`${_.id}-${y}-${O}-${r.name}-${r.type_sale}-3`:D=`${_.id}-${y}-${O}-${r.name}-${r.type_sale}-4`:D=`${_.id}-${y}-${O}-${r.name}-${r.type_sale}`;const T={transaction_id:D,amount:O,order_id:y,order_type:r.type_sale,order_name:r.name,partner_id:_.id,payment_token:S.token,payment_state:S.status};console.log("data payment",T),console.log(T);try{const i=await K.setPaymentDetails(T);i.order_type==="order"?(Y.success("Merci de passer au paiement sur paydunya",{position:"top-center",autoClose:2e3}),A(`/commandes/${y}/détails`)):i.order_type==="preorder"?(console.log("precommande"),Y.success("Merci de passer au paiement sur paydunya",{position:"top-center",autoClose:2e3}),A(`/pre-commandes/${y}/détails`)):i.order_type==="creditorder"?(console.log("commande"),Y.success("Merci de passer au paiement sur paydunya",{position:"top-center",autoClose:2e3}),A(`/credit-commandes/${y}/détails`)):i.payment_state==="completed"&&(Y.success("Paiement effectif",{position:"top-center",autoClose:2e3}),A(`/commandes/${y}/détails`)),localStorage.setItem("urlOrderPayment",S.url),localStorage.setItem("statusOrderPayment",S.status),localStorage.setItem("tokenOrderPayment",S.token),localStorage.setItem("idDataPayment",i.id),localStorage.setItem("idOrderPayment",y),localStorage.setItem("montant",O),localStorage.setItem("responseTextOrderPayment",S.responseText)}catch(i){console.error("erreur lors de l'enregistrement details payment"),console.error(i),Y.error("Payment non effectif "+i.message,{position:"top-center",autoClose:5e3})}}).catch(function(D){console.log(D),Y.error("Payment non effectif "+D,{position:"top-center",autoClose:5e3})}).finally(()=>{f(!1)})}},j=k=>{k.preventDefault(),Zt(w.url),o(!1),r.type_sale==="order"?(A(`/commandes/${y}/détails`),A("/profile#order")):r.type_sale==="preorder"?A("/profile#preorder"):r.type_sale==="creditorder"&&A("/profile#commandes-a-credit")};return p.jsxs(tt,{size:"xl",className:"h-auto",show:u,popup:!0,onClose:E,children:[p.jsx(tt.Header,{}),p.jsx(tt.Body,{children:p.jsx("div",{className:"fixed inset-0 p-4 flex flex-wrap justify-center items-center w-full h-full z-[1000] before:fixed before:inset-0 before:w-full before:h-full before:bg-[rgba(0,0,0,0.5)] overflow-auto font-[sans-serif]",children:p.jsxs("div",{className:"w-full max-w-lg bg-white shadow-lg rounded-lg p-8 relative",children:[p.jsxs("div",{className:"flex items-start border-b border-gray-300 pb-4",children:[p.jsxs("div",{className:"flex-1",children:[p.jsxs("h3",{className:"text-gray-800 text-xl font-bold",children:["Paiement"," ",r.type_sale=="order"?"Commande":r.type_sale=="preorder"?"Pré Commande":"Commande à crédit"," "]}),p.jsx("p",{className:"text-gray-600 text-sm mt-1",children:"Résumé détaillé de votre commande."})]}),p.jsx("p",{children:p.jsx(Nt,{onClick:E,className:"cursor-pointer hover:text-red-500 hover:scale-150 duration-300"})})]}),r&&p.jsx(p.Fragment,{children:p.jsxs("div",{className:"my-8",children:[p.jsx("table",{className:"w-full",children:p.jsx("thead",{children:p.jsxs("tr",{children:[p.jsx("th",{className:"text-left text-gray-800 text-sm py-2",children:"Nom de la commande :"}),p.jsx("th",{className:"text-right text-gray-800 text-sm py-2",children:r.name})]})})}),p.jsxs("table",{className:"w-full",children:[p.jsx("thead",{children:p.jsxs("tr",{children:[p.jsx("th",{className:"text-left text-gray-800 text-sm py-2",children:"Nom produit"}),p.jsx("th",{className:"text-right text-gray-800 text-sm py-2",children:"Prix total"})]})}),p.jsx("tbody",{children:r&&r.order_lines.map((k,S)=>p.jsxs("tr",{children:[p.jsxs("td",{className:"text-left text-gray-800 text-sm py-2",children:[k.product_name," (",k.product_uom_qty,")  "]}),p.jsx("td",{className:"text-right text-gray-800 text-sm py-2 font-medium",children:V(k.price_total)})]},S))})]}),p.jsx("table",{className:"w-full",children:p.jsxs("thead",{children:[p.jsxs("tr",{children:[p.jsx("th",{className:"text-left text-gray-800 text-sm py-2",children:"Total Commande (en FCFA) :"}),p.jsx("th",{className:"text-right text-gray-800 text-sm py-2",children:V(Math.ceil(r.amount_total))})]}),r.payment_mode=="echelonne"&&p.jsx(p.Fragment,{children:p.jsxs("tr",{children:[p.jsx("th",{className:"text-left text-gray-800 text-sm py-2",children:"Total à payer  (en FCFA) :"}),p.jsx("th",{className:"text-right text-gray-800 text-sm py-2",children:V(Math.ceil(O))})]})})]})}),p.jsx("br",{}),p.jsxs("div",{className:"flex max-sm:flex-col items-center gap-4 mt-8",children:[t&&l&&!w&&p.jsxs(lt,{onClick:g,disabled:m,pill:!0,className:"rounded-lg px-5 py-2.5 font-medium w-full hover:bg-red-500 hover:text-white text-xl",children:[" ",m&&p.jsxs(p.Fragment,{children:[p.jsx(Et,{className:"mr-2 h-4 w-4 animate-spin"}),p.jsx("p",{children:"Validation"})]}),!m&&"Valider"]}),t&&l&&w&&p.jsx(lt,{disabled:!w,onClick:k=>j(k),color:"success",pill:!0,className:"rounded-lg px-5 py-2.5 font-medium w-full hover:bg-red-500 hover:text-white text-xl",children:"Passer au paiement"})]})]})})]})})})]})};function Zt(U){const O=window.open(U,"_blank","noopener,noreferrer");O&&(O.opener=null)}function oe(){const{id:U}=$t(),{user:O}=kt();Ft();const[E,r]=B.useState(null),[y,A]=B.useState(!1),[n,b]=B.useState(0),[v,d]=B.useState(null),[h,_]=B.useState(!1),[m,f]=B.useState(0),[u,o]=B.useState(""),[t,e]=B.useState(null),[l,s]=B.useState(!1);console.log(U),B.useEffect(()=>{let k=!0;return(async()=>{A(!0);try{const D=await Mt.getPreCommandeById(O.id,U);if(k){r(D),console.log(D);const T=await K.getPaymentDetailsByIdOrder(D.id);e(T)}}catch(D){console.error("Erreur lors de la récupération des modèles",D)}finally{A(!1)}})(),()=>{k=!1}},[]),B.useEffect(()=>{if(E){const k=E.first_payment_state&&m<1e3||!E.first_payment_state&&m<E.first_payment_amount||y;s(k)}},[E,m,y]);const w=k=>{k&&window.open(k,"_blank","noopener,noreferrer")},R=async(k,S)=>{console.log(S);try{const D=await K.confirmInvoice(S.payment_token);if(D.response_code==="00"&&D.status==="completed"){const T=D.receipt_url;let i=D.customer.name,P=D.customer.email,a=D.customer.phone;if(await K.updatePaymentDetails(S.id,D.status,T,i,P,a,!0))try{await K.createPrecommandePaimentMontant(S.order_id,S.amount,S.payment_token)&&Y.success("Paiement validé avec succès",{position:"top-center",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}catch(N){console.log(N)}finally{A(!1)}}else Y.error("Vérification du paiement echouée",{position:"top-center",autoClose:5e3})}catch(D){console.error("Erreur lors de la confirmation de l'invoice :",D.message)}finally{A(!1)}},g=async(k,S)=>{k.preventDefault(),S<1e3?Y.warning("Le Montant doit être strictement supérieur à 1000 F CFA",{position:"top-center",autoClose:5e3}):_(!0),console.log(S,E.id)},j=async()=>{console.log(n,v)};return p.jsxs(p.Fragment,{children:[p.jsx(Dt,{title:"CCBM Shop | Détails Précommande",description:"Découvrez les meilleures offres sur CCBM Shop, votre destination privilégiée pour l'électroménager de qualité. Explorez nos produits allant des réfrigérateurs aux téléviseurs intelligents, et profitez de promotions exclusives !",keywords:"électroménager, boutique en ligne d'électroménager, CCBM Shop, ccbme, appareils électroménagers à prix réduits, smart TV, réfrigérateurs modernes, climatiseurs efficaces, promotions électroménager"}),p.jsx(Ot,{childrenClasses:"pt-0 pb-0",children:p.jsxs("div",{className:"checkout-page-wrapper w-full bg-white pb-[60px]",children:[p.jsx("div",{className:"w-full mb-5",children:p.jsx(Pt,{title:"Détails Pré Commande",breadcrumb:[{name:"Accueil",path:"/"},{name:"Précommandes",path:"/profile#preorder"},{name:"Détails Précommande "}]})}),y&&p.jsx("div",{className:"flex justify-center items-center w-full h-full",children:p.jsx(ft,{size:60,className:"animate-spin"})}),E&&p.jsx("div",{className:"checkout-main-content w-full",children:p.jsxs("div",{className:"container-x mx-auto",children:[p.jsxs("div",{className:"w-full sm:mb-10 mb-5",children:[p.jsxs("div",{className:"sm:flex sm:space-x-[18px] s",children:[p.jsx("div",{className:"sm:w-1/3 w-full mb-5 h-[70px]",children:p.jsx("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex justify-center items-center",children:p.jsxs("span",{className:"text-[15px] font-medium",children:["N°Précommande ",p.jsx("span",{children:E.name})]})})}),p.jsx("div",{className:" sm:w-1/3  flex-1 h-[70px]",children:p.jsx("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex justify-center items-center",children:p.jsxs("span",{className:"text-[15px] font-medium",children:["Paiement :"," ",E.advance_payment_status==="not_paid"&&p.jsx("span",{className:"text-red-500",children:"Non Payé"}),E.advance_payment_status==="paid"&&p.jsx("span",{className:"text-green-500",children:" Payé "}),E.advance_payment_status==="partial"&&p.jsxs("span",{className:"text-yellow-500",children:[" ","Partiellement Payé"]})]})})}),p.jsx("div",{className:"sm:w-1/3 flex-1 h-[70px]",children:p.jsx("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex justify-center items-center",children:p.jsxs("span",{className:"text-[15px] font-medium",children:["Statut :"," ",E.state=="sale"&&p.jsx("span",{className:"text-green-500",children:" Validée "}),E.state=="to_delivered"&&p.jsx("span",{className:"text-yellow-500",children:" En cours de livraison "}),E.state=="delivered"&&p.jsx("span",{className:"text-green-600",children:" Livrée "}),E.state!="delivered"&&E.state!="sale"&&E.state!="to_delivered"&&p.jsx("span",{className:"text-gray-500",children:" Non validé "})]})})})]}),p.jsxs("div",{className:"flex flex-col sm:flex-row sm:space-x-[18px] space-y-5 sm:space-y-0 mb-5",children:[p.jsx("div",{className:"w-full sm:w-1/2 h-auto sm:h-[70px]",children:p.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[p.jsx("strong",{children:" Date Précommande "}),p.jsx("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:p.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:ht(E.date_order)})})]})}),p.jsx("div",{className:"w-full sm:w-1/2 h-auto sm:h-[70px]",children:p.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[p.jsx("strong",{children:"Date de livraison"}),p.jsx("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:p.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:ht(E.commitment_date)})})]})})]}),p.jsxs("div",{className:"sm:flex sm:space-x-[18px] s",children:[p.jsx("div",{className:"sm:w-1/2 w-full mb-5 h-[70px]",children:p.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[p.jsx("strong",{children:"  Total Payé   "}),p.jsx("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:p.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:V(E.amount_total-E.amount_residual)})})]})}),p.jsx("div",{className:"flex-1 h-[70px]",children:p.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[p.jsx("strong",{children:"     Total Restant   "}),p.jsx("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:p.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:V(E.amount_residual)})})]})})]}),t&&t.length>0&&p.jsx(p.Fragment,{children:p.jsxs("div",{className:"w-full max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[p.jsx("h1",{className:"text-2xl sm:text-3xl text-qblack font-medium mb-5 text-center",children:"Récapitulatif Paiement"}),p.jsxs("div",{className:"w-full px-4 sm:px-10 py-6 sm:py-[30px] border border-[#EDEDED] rounded-lg",children:[p.jsxs("div",{className:"mb-6",children:[p.jsx("p",{className:"text-sm sm:text-base font-medium text-qblack uppercase mb-2",children:"Détails Paiements"}),p.jsx("div",{className:"w-full h-[1px] bg-[#EDEDED]"})]}),p.jsx("div",{className:"overflow-x-auto",children:p.jsxs("table",{className:"min-w-full bg-white",children:[p.jsx("thead",{className:"hidden sm:table-header-group",children:p.jsxs("tr",{children:[p.jsx("th",{className:"px-4 py-3 border-b border-gray-200 bg-gray-50 text-left text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider",children:"Prénom & Nom"}),p.jsx("th",{className:"px-4 py-3 border-b border-gray-200 bg-gray-50 text-left text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider",children:"Téléphone"}),p.jsx("th",{className:"px-4 py-3 border-b border-gray-200 bg-gray-50 text-left text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),p.jsx("th",{className:"px-4 py-3 border-b border-gray-200 bg-gray-50 text-left text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider",children:"Montant Payé"}),p.jsx("th",{className:"px-4 py-3 border-b border-gray-200 bg-gray-50 text-left text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider",children:"Facture"})]})}),p.jsx("tbody",{children:t.map((k,S)=>k.payment_state==="completed"&&p.jsxs("tr",{className:"sm:bg-white flex flex-col sm:table-row mb-6 sm:mb-0",children:[p.jsx("td",{className:"px-4 py-3 sm:border-b border-gray-200",children:p.jsxs("div",{className:"flex items-center justify-between sm:table-cell",children:[p.jsx("span",{className:"sm:hidden font-medium",children:"Prénom & Nom:"}),p.jsx("span",{className:"text-sm leading-5 text-gray-900",children:k.customer_name})]})}),p.jsx("td",{className:"px-4 py-3 sm:border-b border-gray-200",children:p.jsxs("div",{className:"flex items-center justify-between sm:table-cell",children:[p.jsx("span",{className:"sm:hidden font-medium",children:"Téléphone:"}),p.jsx("span",{className:"text-sm leading-5 text-gray-900",children:k.customer_phone})]})}),p.jsx("td",{className:"px-4 py-3 sm:border-b border-gray-200",children:p.jsxs("div",{className:"flex items-center justify-between sm:table-cell",children:[p.jsx("span",{className:"sm:hidden font-medium",children:"Email:"}),p.jsx("span",{className:"text-sm leading-5 text-gray-900",children:k.customer_email})]})}),p.jsx("td",{className:"px-4 py-3 sm:border-b border-gray-200",children:p.jsxs("div",{className:"flex items-center justify-between sm:table-cell",children:[p.jsx("span",{className:"sm:hidden font-medium",children:"Montant Payé:"}),p.jsx("span",{className:"text-sm leading-5 text-gray-900",children:V(k.amount)})]})}),p.jsx("td",{className:"px-4 py-3 sm:border-b border-gray-200",children:p.jsxs("div",{className:"flex items-center justify-between sm:table-cell",children:[p.jsx("span",{className:"sm:hidden font-medium",children:"Facture:"}),k.token_status?p.jsx("button",{className:"text-sm leading-5 text-blue-600 underline",onClick:()=>w(k.url_facture),children:"Ouvrir la facture"}):p.jsx("button",{className:"text-sm leading-5 text-blue-600 underline",onClick:D=>R(D,k),children:"Vérifier le paiement"})]})})]},S))})]})})]})]})})]}),p.jsxs("div",{className:"w-full max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[p.jsx("h1",{className:"text-2xl sm:text-3xl text-qblack font-medium mb-5 text-center",children:"Récapitulatif de la commande"}),p.jsxs("div",{className:"w-full p-4 sm:p-6 border border-[#EDEDED] rounded-lg shadow-sm",children:[p.jsxs("div",{className:"sub-total mb-6",children:[p.jsxs("div",{className:" flex justify-between mb-5",children:[p.jsx("p",{className:"text-[13px] font-medium text-qblack uppercase",children:"Produit"}),p.jsx("p",{className:"text-[13px] font-medium text-qblack uppercase",children:"total"})]}),p.jsx("div",{className:"w-full h-[1px] bg-[#EDEDED]"})]}),p.jsx("div",{className:"product-list w-full mb-[30px]",children:p.jsx("ul",{className:"flex flex-col space-y-5",children:E.order_lines.map((k,S)=>p.jsx(p.Fragment,{children:p.jsx("li",{children:p.jsxs("div",{className:"flex justify-between items-center",children:[p.jsxs("div",{children:[p.jsxs("h4",{className:"text-[15px] text-qblack mb-2.5",children:[k.product_name,p.jsxs("sup",{className:"text-[13px] text-qgray ml-2 mt-2",children:["x ",k.product_uom_qty]})]}),p.jsx("p",{className:"text-[13px] text-qgray",children:k.description})]}),p.jsx("div",{children:p.jsx("span",{className:"text-[15px] text-qblack font-medium",children:V(k.price_total)})})]})},S)}))})}),p.jsx("div",{className:"w-full h-[1px] bg-[#EDEDED]"}),p.jsxs("div",{className:"space-y-4",children:[p.jsx("div",{className:"border-t pt-4 space-y-2",children:[{label:"Montant Total",value:V(E.amount_total)},{label:"Premier Tranche",value:V(E.first_payment_amount),date:E.first_payment_date,state:E.first_payment_state},{label:"Deuxieme Tranche",value:V(E.second_payment_amount),date:E.second_payment_date,state:E.second_payment_state},{label:"Troisieme Tranche",value:V(E.third_payment_amount),date:E.third_payment_date,state:E.third_payment_state}].map((k,S)=>p.jsxs("dl",{className:"flex flex-wrap items-center justify-between gap-2",children:[p.jsx("dt",{className:"text-sm text-gray-500",children:k.label}),k.date&&p.jsx("dd",{className:`text-xs sm:text-sm font-medium ${k.state?"text-green-500":"text-red-500"}`,children:k.date}),p.jsx("dd",{className:`text-sm sm:text-base font-medium ${k.state?"text-green-500":k.date?"text-red-500":"text-gray-900"}`,children:k.value})]},S))}),p.jsxs("dl",{className:"flex items-center justify-between gap-4 border-t border-gray-200 pt-2 dark:border-gray-700",children:[p.jsx("dt",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"Total à payer"}),p.jsx("dd",{className:"text-lg font-bold text-gray-900 dark:text-white",children:V(E.amount_total)})]}),E.amount_residual>=0&&p.jsxs("dl",{className:"flex items-center justify-between gap-4 border-t border-gray-200 pt-2 dark:border-gray-700",children:[p.jsx("dt",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"Total Payé"}),p.jsx("dd",{className:"text-lg font-bold text-green-500 dark:text-white",children:V(E.amount_total-E.amount_residual)})]}),E.amount_residual>=0&&p.jsxs("dl",{className:"flex items-center justify-between gap-4 border-t border-gray-200 pt-2 dark:border-gray-700",children:[p.jsx("dt",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"Total Restant"}),p.jsx("dd",{className:"text-lg font-bold text-gray-900 dark:text-white",children:V(E.amount_residual)})]})]}),p.jsxs("div",{className:"w-full",children:[(E.advance_payment_status==="not_paid"||E.advance_payment_status==="partial")&&p.jsxs(p.Fragment,{children:[p.jsxs("div",{className:"input-item mb-5",children:[p.jsx("div",{className:"mb-2 inline-block",children:p.jsx(Lt,{htmlFor:"montant",value:"Montant à payer"})}),p.jsx(It,{id:"montant",placeholder:"1000",label:"Montant*",name:"montantAPayer",type:"number",value:m,max:E.amount_residual,min:E.first_payment_state?1e3:E.first_payment_amount,onChange:k=>{const S=k.target.value;S<=E.amount_residual&&f(S),!E.first_payment_state&&S<E.first_payment_amount?o(`Le montant entré doit être supérieur ou égal à la première tranche de ${V(E.first_payment_amount)}.`):o("")},required:!0,className:"invalid:border-red-500 invalid:text-red-600 focus:invalid:border-red-500 focus:invalid:ring-red-500"}),u&&p.jsx("p",{className:"text-red-600",children:u})]}),E&&p.jsx(p.Fragment,{children:E.state!=="sale"&&E.state!=="draft"?p.jsx("div",{className:"flex justify-center items-center mt-2",children:p.jsx("span",{className:"text-lg font-medium text-red-500 dark:text-white",children:"La précommande est annulée, vous ne pouvez pas passer à la caisse."})}):p.jsxs(lt,{type:"submit",onClick:k=>g(k,m),className:"rounded-lg px-5 py-2.5 font-medium w-full hover:bg-red-500 hover:text-white text-xl",disabled:l,children:[y&&p.jsx(Et,{className:"mr-2 h-4 w-4 animate-spin"}),"Passer à la caisse (",V(m),")"]})}),h&&E&&p.jsx(Wt,{handlePay:j,totalAmount:m,onClose:()=>_(!1),order:E,idOrder:E.id})]}),E.advance_payment_status==="paid"&&p.jsx("div",{className:"flex justify-center items-center mt-2",children:p.jsx("span",{className:"text-lg font-medium text-green-500 dark:text-white",children:"Votre paiement est déjà réglé"})})]})]})]})]})}),!E&&p.jsx(p.Fragment,{children:p.jsxs("div",{className:"flex justify-center items-center ",children:[p.jsx(ft,{className:"animate-spin"})," Précommande non trouvée"]})})]})})]})}export{oe as default};
