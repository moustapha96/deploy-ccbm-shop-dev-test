import{d as j,j as e,R as y,l as v,m as w,n as C,h as A,i as k,o as S,L as T,p as q}from"./index.C32mkGiH.js";import{b as m,c as P,u as E}from"./vendor.EKSpuOPe.js";function F({className:a,filterToggle:l,updateUrlParams:n}){const{filters:i,updateFilters:o}=m.useContext(j),[s,d]=m.useState([]);m.useEffect(()=>{(async()=>{try{const c=await v.getTags();d(Array.isArray(c)?c:[])}catch(c){console.error("Erreur lors de la récupération des tags",c),d([])}})()},[]);const x=r=>{const[c,h]=r,f={...i,min:c,max:h,page:1};o(f),n(f)},g=r=>{const c=r.target.value,h={...i,tag:c,page:1};o(h),n(h)};return e.jsxs("div",{className:`filter-widget w-full fixed lg:relative left-0 top-0 h-screen z-10 lg:h-auto overflow-y-scroll lg:overflow-y-auto bg-white px-[30px] pt-[40px] ${a||""} ${l?"block":"hidden lg:block"}`,children:[e.jsxs("div",{className:"filter-subject-item pb-10 border-b border-qgray-border mt-10",children:[e.jsx("div",{className:"subject-title mb-[20px]",children:e.jsx("h1",{className:"text-black text-base font-500",children:"Filtrer par tags"})}),e.jsx("div",{className:"text-sm text-qgray",children:e.jsxs("select",{className:"w-full border border-qgray-border px-3 py-2 rounded",value:i.tag??"All",onChange:g,children:[e.jsx("option",{value:"All",children:"Tous les tags"}),s.map(r=>e.jsx("option",{value:r.slug||r.name,children:r.name},r.id))]})})]}),e.jsxs("div",{className:"filter-subject-item pb-10 border-b border-qgray-border mt-10",children:[e.jsx("div",{className:"subject-title mb-[30px]",children:e.jsx("h1",{className:"text-black text-base font-500",children:"Échelle des prix"})}),e.jsx("div",{className:"price-range mb-5",children:e.jsx(y,{value:[i.min,i.max],onInput:x,min:1e3,max:5e6})}),e.jsxs("p",{className:"text-xs text-qblack font-400",children:["Prix (FCFA): ",i.min," - ",i.max]})]})]})}const M=({currentPage:a,totalPages:l,onPageChange:n})=>{const i=()=>{const s=[];for(let d=Math.max(2,a-2);d<=Math.min(l-1,a+2);d++)s.push(d);return a-2>2&&s.unshift("..."),a+2<l-1&&s.push("..."),s.unshift(1),l!==1&&s.push(l),s};return e.jsx("nav",{className:"flex justify-center items-center mt-8 px-4","aria-label":"Pagination",children:e.jsxs("ul",{className:"flex flex-wrap justify-center items-center space-x-1 md:space-x-2",children:[e.jsx("li",{children:e.jsx("button",{onClick:()=>n(Math.max(1,a-1)),disabled:a===1,className:"p-2 rounded-full bg-gray-200 text-gray-700 hover:bg-qyellow disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Previous page",children:e.jsx(w,{className:"w-5 h-5"})})}),i().map((o,s)=>e.jsx("li",{children:typeof o=="number"?e.jsx("button",{onClick:()=>n(o),className:`hidden sm:block px-3 py-2 rounded ${a===o?"bg-bleu-logo text-white":"bg-gray-200 text-gray-700 hover:bg-qyellow"}`,"aria-current":a===o?"page":void 0,children:o}):e.jsx("span",{className:"hidden sm:block px-3 py-2",children:o})},s)),e.jsx("li",{className:"sm:hidden",children:e.jsxs("span",{className:"px-3 py-2 text-gray-700",children:[a," / ",l]})}),e.jsx("li",{children:e.jsx("button",{onClick:()=>n(Math.min(l,a+1)),disabled:a===l,className:"p-2 rounded-full bg-gray-200 text-gray-700 hover:bg-qyellow disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Next page",children:e.jsx(C,{className:"w-5 h-5"})})})]})})};function B(){const{currentProductsPromo:a,totalProductsPromo:l,isLoadingProductPromo:n,fetchProdcutsPromo:i,updateFilters:o,filters:s,resetFilters:d}=m.useContext(j),x=P(),g=E();m.useEffect(()=>{d();const t=new URLSearchParams(x.search),p={page:Number(t.get("page"))||1,category:t.get("category")||"All",search:t.get("search")||"",min:Number(t.get("min"))||1e3,max:Number(t.get("max"))||5e6,limit:Number(t.get("limit"))||9,productType:t.get("productType")||"All",tag:t.get("tag")||"All"};o(p),window.scrollTo({top:0,left:0,behavior:"smooth"})},[x.search,x.pathname]),m.useEffect(()=>{i()},[i,s]);const r=m.useCallback(t=>{const p=new URLSearchParams(x.search);Object.entries(t).forEach(([b,u])=>{u==null||u===""||u==="All"?p.delete(b):p.set(b,String(u))}),g({search:p.toString()},{replace:!0})},[x.search,g]),c=t=>{r({...s,page:t}),window.scrollTo({top:0,left:0,behavior:"smooth"})},h=t=>{r({...s,category:t||"All",page:1}),window.scrollTo({top:0,left:0,behavior:"smooth"})},f=l>0?(s.page-1)*s.limit+1:0,N=Math.min(s.page*s.limit,l);return e.jsxs(e.Fragment,{children:[e.jsx(A,{title:"CCBM Shop | En Promo",description:"Découvrez les meilleures offres promotionnelles sur CCBM Shop, votre destination privilégiée pour l'électroménager de qualité à prix réduits.",keywords:"électroménager, promotions, offres spéciales, CCBM Shop, ccbme, appareils électroménagers à prix réduits"}),e.jsx(k,{children:e.jsx("div",{className:"products-page-wrapper w-full",children:e.jsxs("div",{className:"container-x mx-auto",children:[e.jsx(S,{}),e.jsxs("div",{className:"w-full lg:flex lg:space-x-[30px]",children:[e.jsx("div",{className:"lg:w-[270px]",children:e.jsx(F,{updateUrlParams:r,handleCategoryChange:h})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"products-sorting w-full bg-white flex flex-col md:flex-row justify-between p-[30px] mb-[40px]",children:e.jsxs("p",{className:"font-400 text-[13px]",children:[e.jsx("span",{className:"text-qgray",children:"Affichage"})," ",l>0?`${f}–${N} sur ${l} résultats`:"0 résultat"]})}),n?e.jsxs("div",{className:"flex justify-center items-center",children:[e.jsx(T,{className:"animate-spin"})," Chargement"]}):a.length===0?e.jsx("div",{className:"flex justify-center items-center",children:"Aucun produit en promotion trouvé"}):e.jsx("div",{className:"grid xl:grid-cols-3 grid-cols-2 gap-[30px]",children:a.map(t=>e.jsx(q,{datas:t},t.id))}),e.jsx(M,{currentPage:s.page,totalPages:Math.ceil(l/s.limit),onPageChange:c})]})]})]})})})]})}export{B as default};
